(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[582],{4184:function(t,e){var r;/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/!function(){"use strict";var n={}.hasOwnProperty;function o(){for(var t=[],e=0;e<arguments.length;e++){var r=arguments[e];if(r){var i=typeof r;if("string"===i||"number"===i)t.push(r);else if(Array.isArray(r)){if(r.length){var a=o.apply(null,r);a&&t.push(a)}}else if("object"===i){if(r.toString!==Object.prototype.toString&&!r.toString.toString().includes("[native code]")){t.push(r.toString());continue}for(var s in r)n.call(r,s)&&r[s]&&t.push(s)}}}return t.join(" ")}t.exports?(o.default=o,t.exports=o):void 0!==(r=(function(){return o}).apply(e,[]))&&(t.exports=r)}()},6965:function(t,e,r){"use strict";r.d(e,{aK:function(){return ev},Qr:function(){return e$},ii:function(){return p},JF:function(){return ty},qB:function(){return eI},_C:function(){return function t(e,r){var n=new w(r.width,r.height),o=n.width,i=n.height;if(o<=0||i<=0)throw Error("resizeResults - invalid dimensions: "+JSON.stringify({width:o,height:i}));if(Array.isArray(e))return e.map(function(e){return t(e,{width:o,height:i})});if(tY(e)){var a=e.detection.forSize(o,i),s=e.unshiftedLandmarks.forSize(a.box.width,a.box.height);return tX(G(e,a),s)}return X(e)?G(e,e.detection.forSize(o,i)):e instanceof U||e instanceof B?e.forSize(o,i):e}}});var n,o,i,a,s,c,u,f,h,p={};r.r(p),r.d(p,{AnchorPosition:function(){return u},DrawBox:function(){return ta},DrawBoxOptions:function(){return ti},DrawFaceLandmarks:function(){return tV},DrawFaceLandmarksOptions:function(){return tG},DrawTextField:function(){return to},DrawTextFieldOptions:function(){return tn},drawContour:function(){return d},drawDetections:function(){return ts},drawFaceExpressions:function(){return tW},drawFaceLandmarks:function(){return tJ}});var l=r(75);function d(t,e,r){if(void 0===r&&(r=!1),t.beginPath(),e.slice(1).forEach(function(r,n){var o=r.x,i=r.y,a=e[n];t.moveTo(a.x,a.y),t.lineTo(o,i)}),r){var n=e[e.length-1],o=e[0];if(!n||!o)return;t.moveTo(n.x,n.y),t.lineTo(o.x,o.y)}t.stroke()}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var v=function(t,e){return(v=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function m(t,e){function r(){this.constructor=t}v(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var g=function(){return(g=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function y(t,e,r,n){return new(r||(r=Promise))(function(o,i){function a(t){try{c(n.next(t))}catch(e){i(e)}}function s(t){try{c(n.throw(t))}catch(e){i(e)}}function c(t){var e;t.done?o(t.value):((e=t.value)instanceof r?e:new r(function(t){t(e)})).then(a,s)}c((n=n.apply(t,e||[])).next())})}function b(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function _(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),o=0,e=0;e<r;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n}var w=function(){function t(t,e){if(!F(t)||!F(e))throw Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:e}));this._width=t,this._height=e}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.reverse=function(){return new t(1/this.width,1/this.height)},t}();function x(t,e){return t instanceof l.esB&&t.shape.length===e}function E(t){return x(t,4)}function P(t,e){void 0===e&&(e=2);var r=Math.pow(10,e);return Math.floor(t*r)/r}function M(t){return t&&t.width&&t.height}function S(t){return t.reduce(function(t,e){return t.add(e)},new I(0,0)).div(new I(t.length,t.length))}function T(t,e,r){return Array(t).fill(0).map(function(t,n){return e+n*r})}function F(t){return!!t&&t!==1/0&&t!==-1/0&&!isNaN(t)||0===t}function C(t){return F(t)&&0<=t&&t<=1}var I=function(){function t(t,e){this._x=t,this._y=e}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.mul=function(e){return new t(this.x*e.x,this.y*e.y)},t.prototype.div=function(e){return new t(this.x/e.x,this.y/e.y)},t.prototype.abs=function(){return new t(Math.abs(this.x),Math.abs(this.y))},t.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t}(),O=function(){function t(e,r){void 0===r&&(r=!0);var n=e||{},o=[n.left,n.top,n.right,n.bottom].every(F),i=[n.x,n.y,n.width,n.height].every(F);if(!i&&!o)throw Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(n));var a=i?[n.x,n.y,n.width,n.height]:[n.left,n.top,n.right-n.left,n.bottom-n.top],s=a[0],c=a[1],u=a[2],f=a[3];t.assertIsValidBox({x:s,y:c,width:u,height:f},"Box.constructor",r),this._x=s,this._y=c,this._width=u,this._height=f}return t.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(F)},t.assertIsValidBox=function(e,r,n){if(void 0===n&&(n=!1),!t.isRect(e))throw Error(r+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!n&&(e.width<0||e.height<0))throw Error(r+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeft",{get:function(){return new I(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topRight",{get:function(){return new I(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeft",{get:function(){return new I(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomRight",{get:function(){return new I(this.right,this.bottom)},enumerable:!0,configurable:!0}),t.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(t){return Math.round(t)}),r=e[0],n=e[1],o=e[2],i=e[3];return new t({x:r,y:n,width:o,height:i})},t.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(t){return Math.floor(t)}),r=e[0],n=e[1],o=e[2],i=e[3];return new t({x:r,y:n,width:o,height:i})},t.prototype.toSquare=function(){var e=this.x,r=this.y,n=this.width,o=this.height,i=Math.abs(n-o);return n<o&&(e-=i/2,n+=i),o<n&&(r-=i/2,o+=i),new t({x:e,y:r,width:n,height:o})},t.prototype.rescale=function(e){var r=M(e)?e.width:e,n=M(e)?e.height:e;return new t({x:this.x*r,y:this.y*n,width:this.width*r,height:this.height*n})},t.prototype.pad=function(e,r){var n=[this.x-e/2,this.y-r/2,this.width+e,this.height+r],o=n[0],i=n[1],a=n[2],s=n[3];return new t({x:o,y:i,width:a,height:s})},t.prototype.clipAtImageBorders=function(e,r){var n=this.x,o=this.y,i=this.right,a=this.bottom,s=Math.max(n,0),c=Math.max(o,0);return new t({x:s,y:c,width:Math.min(i-s,e-s),height:Math.min(a-c,r-c)}).floor()},t.prototype.shift=function(e,r){var n=this.width,o=this.height,i=this.x+e,a=this.y+r;return new t({x:i,y:a,width:n,height:o})},t.prototype.padAtBorders=function(t,e){var r=this.width+1,n=this.height+1,o=r,i=n,a=this.left,s=this.top,c=this.right,u=this.bottom;return c>e&&(o=-c+e+r,c=e),u>t&&(i=-u+t+n,u=t),a<1&&(i=2-a,a=1),s<1&&(i=2-s,s=1),{dy:1,edy:i,dx:1,edx:o,y:s,ey:u,x:a,ex:c,w:r,h:n}},t.prototype.calibrate=function(e){return new t({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},t}(),D=function(t){function e(e,r,n,o,i){return void 0===i&&(i=!1),t.call(this,{left:e,top:r,right:n,bottom:o},i)||this}return m(e,t),e}(O),A=function(){function t(t,e,r,n,o){this._imageDims=new w(o.width,o.height),this._score=t,this._classScore=e,this._className=r,this._box=new O(n).rescale(this._imageDims)}return Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativeBox",{get:function(){return new O(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),t.prototype.forSize=function(e,r){return new t(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:r})},t}(),B=function(t){function e(e,r,n){return t.call(this,e,e,"",r,n)||this}return m(e,t),e.prototype.forSize=function(r,n){var o=t.prototype.forSize.call(this,r,n),i=o.score,a=o.relativeBox,s=o.imageDims;return new e(i,a,s)},e}(A);function L(t,e,r,n){void 0===n&&(n=!0);for(var o=e.map(function(t,e){return{score:t,boxIndex:e}}).sort(function(t,e){return t.score-e.score}).map(function(t){return t.boxIndex}),i=[];o.length>0;)!function(){var e=o.pop();i.push(e);for(var a=o,s=[],c=0;c<a.length;c++){var u=a[c],f=t[e],h=t[u];s.push(function(t,e,r){void 0===r&&(r=!0);var n=Math.max(0,Math.min(t.right,e.right)-Math.max(t.left,e.left))*Math.max(0,Math.min(t.bottom,e.bottom)-Math.max(t.top,e.top));return r?n/(t.area+e.area-n):n/Math.min(t.area,e.area)}(f,h,n))}o=o.filter(function(t,e){return s[e]<=r})}();return i}function k(t,e){return l.lub(function(){var r=e[0],n=e[1],o=e[2],i=l.hlL(_(t.shape.slice(0,3),[1]),r),a=l.hlL(_(t.shape.slice(0,3),[1]),n),s=l.hlL(_(t.shape.slice(0,3),[1]),o),c=l.zoF([i,a,s],3);return l.luU(t,c)})}function j(t){return 1/(1+Math.exp(-t))}var R=function(t){function e(e,r,n,o,i){return void 0===i&&(i=!1),t.call(this,{x:e,y:r,width:n,height:o},i)||this}return m(e,t),e}(O),U=function(){function t(t,e,r){void 0===r&&(r=new I(0,0));var n=e.width,o=e.height;this._imgDims=new w(n,o),this._shift=r,this._positions=t.map(function(t){return t.mul(new I(n,o)).add(r)})}return Object.defineProperty(t.prototype,"shift",{get:function(){return new I(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map(function(e){return e.sub(t._shift).div(new I(t.imageWidth,t.imageHeight))})},enumerable:!0,configurable:!0}),t.prototype.forSize=function(t,e){return new this.constructor(this.relativePositions,{width:t,height:e})},t.prototype.shiftBy=function(t,e){return new this.constructor(this.relativePositions,this._imgDims,new I(t,e))},t.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},t.prototype.align=function(t,e){if(void 0===e&&(e={}),t){var r=t instanceof B?t.box.floor():new O(t);return this.shiftBy(r.x,r.y).align(null,e)}var n=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),o=n.useDlibAlignment,i=n.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(i)},t.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),e=t[0],r=t[1],n=t[2],o=function(t){return n.sub(t).magnitude()},i=Math.floor((o(e)+o(r))/2/.45),a=S(t),s=Math.floor(Math.max(0,a.x-.5*i)),c=Math.floor(Math.max(0,a.y-.43*i));return new R(s,c,Math.min(i,this.imageWidth+s),Math.min(i,this.imageHeight+c))},t.prototype.alignMinBbox=function(t){var e,r,n,o,i,a,s,c=(r=(e=this.positions).map(function(t){return t.x}),n=e.map(function(t){return t.y}),o=r.reduce(function(t,e){return e<t?e:t},1/0),i=n.reduce(function(t,e){return e<t?e:t},1/0),a=r.reduce(function(t,e){return t<e?e:t},0),s=n.reduce(function(t,e){return t<e?e:t},0),new D(o,i,a,s));return c.pad(c.width*t,c.height*t)},t.prototype.getRefPointsForAlignment=function(){throw Error("getRefPointsForAlignment not implemented by base class")},t}(),N=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],S([t[3],t[4]])]},e}(U),H=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(S)},e}(U),z=function(){function t(t,e){this._label=t,this._distance=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){return void 0===t&&(t=!0),""+this.label+(t?" ("+P(this.distance)+")":"")},t}(),W=function(t){function e(e,r){var n=t.call(this,e)||this;return n._label=r,n}return m(e,t),e.assertIsValidLabeledBox=function(t,e){if(O.assertIsValidBox(t,e),!F(t.label))throw Error(e+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(O),Y=function(){function t(t,e){if("string"!=typeof t)throw Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some(function(t){return!(t instanceof Float32Array)}))throw Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(t){return Array.from(t)})}},t.fromJSON=function(e){var r=e.descriptors.map(function(t){return new Float32Array(t)});return new t(e.label,r)},t}();function X(t){return t.detection instanceof B}function G(t,e){return Object.assign({},t,{detection:e})}function V(){var t=window.fetch||function(){throw Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:t,readFile:function(){throw Error("readFile - filesystem not available for browser environment")}}}function J(t){var e="";if(!t)try{t=r(Object(function(){var t=Error("Cannot find module 'fs'");throw t.code="MODULE_NOT_FOUND",t}()))}catch(n){e=n.toString()}return{readFile:t?function(e){return new Promise(function(r,n){t.readFile(e,function(t,e){return t?n(t):r(e)})})}:function(){throw Error("readFile - failed to require fs in nodejs environment with error: "+e)}}}function q(){var t=r.g.Canvas||r.g.HTMLCanvasElement,e=r.g.Image||r.g.HTMLImageElement,n=r.g.fetch||function(){throw Error("fetch - missing fetch implementation for nodejs environment")},o=J();return g({Canvas:t||function(){},CanvasRenderingContext2D:r.g.CanvasRenderingContext2D||function(){},Image:e||function(){},ImageData:r.g.ImageData||function(){},Video:r.g.HTMLVideoElement||function(){},createCanvasElement:function(){if(t)return new t;throw Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(e)return new e;throw Error("createImageElement - missing Image implementation for nodejs environment")},fetch:n},o)}function $(){return"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D}!function(t){function e(e,r,n,o){var i=t.call(this,e,r)||this;return i._score=n,i._classScore=o,i}m(e,t),e.assertIsValidPredictedBox=function(t,e){if(W.assertIsValidLabeledBox(t,e),!C(t.score)||!C(t.classScore))throw Error(e+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(W);var K=r(3454);function Q(){return"object"==typeof r.g&&void 0!==K&&!!K.version}function Z(){$()&&(c=V()),Q()&&(c=q())}var tt={getEnv:function(){if(!c)throw Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return c},setEnv:function(t){c=t},initialize:Z,createBrowserEnv:V,createFileSystem:J,createNodejsEnv:q,monkeyPatch:function(t){if(c||Z(),!c)throw Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=t.Canvas,r=void 0===e?c.Canvas:e,n=t.Image,o=void 0===n?c.Image:n;c.Canvas=r,c.Image=o,c.createCanvasElement=t.createCanvasElement||function(){return new r},c.createImageElement=t.createImageElement||function(){return new o},c.ImageData=t.ImageData||c.ImageData,c.Video=t.Video||c.Video,c.fetch=t.fetch||c.fetch,c.readFile=t.readFile||c.readFile},isBrowser:$,isNodejs:Q};function te(t){return tt.isNodejs()||"string"!=typeof t?t:document.getElementById(t)}function tr(t){var e=tt.getEnv(),r=e.Canvas;if(t instanceof e.CanvasRenderingContext2D)return t;var n=te(t);if(!(n instanceof r))throw Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=n.getContext("2d");if(!o)throw Error("resolveContext2d - canvas 2d context is null");return o}Z(),(n=u||(u={})).TOP_LEFT="TOP_LEFT",n.TOP_RIGHT="TOP_RIGHT",n.BOTTOM_LEFT="BOTTOM_LEFT",n.BOTTOM_RIGHT="BOTTOM_RIGHT";var tn=function(t){void 0===t&&(t={});var e=t.anchorPosition,r=t.backgroundColor,n=t.fontColor,o=t.fontSize,i=t.fontStyle,a=t.padding;this.anchorPosition=e||u.TOP_LEFT,this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=n||"rgba(255, 255, 255, 1)",this.fontSize=o||14,this.fontStyle=i||"Georgia",this.padding=a||4},to=function(){function t(e,r,n){void 0===n&&(n={}),this.text="string"==typeof e?[e]:e instanceof t?e.text:e,this.anchor=r,this.options=new tn(n)}return t.prototype.measureWidth=function(t){var e=this.options.padding;return this.text.map(function(e){return t.measureText(e).width}).reduce(function(t,e){return t<e?e:t},0)+2*e},t.prototype.measureHeight=function(){var t=this.options,e=t.fontSize,r=t.padding;return this.text.length*e+2*r},t.prototype.getUpperLeft=function(t,e){var r=this.options.anchorPosition,n=r===u.BOTTOM_RIGHT||r===u.TOP_RIGHT,o=r===u.BOTTOM_LEFT||r===u.BOTTOM_RIGHT,i=this.measureWidth(t),a=this.measureHeight(),s=n?this.anchor.x-i:this.anchor.x,c=o?this.anchor.y-a:this.anchor.y;return e?{x:Math.max(Math.min(s,e.width-i),0),y:Math.max(Math.min(c,e.height-a),0)}:{x:s,y:c}},t.prototype.draw=function(t){var e=te(t),r=tr(e),n=this.options,o=n.backgroundColor,i=n.fontColor,a=n.fontSize,s=n.fontStyle,c=n.padding;r.font=a+"px "+s;var u=this.measureWidth(r),f=this.measureHeight();r.fillStyle=o;var h=this.getUpperLeft(r,e);r.fillRect(h.x,h.y,u,f),r.fillStyle=i,this.text.forEach(function(t,e){var n=c+h.x,o=c+h.y+(e+1)*a;r.fillText(t,n,o)})},t}(),ti=function(t){void 0===t&&(t={});var e=t.boxColor,r=t.lineWidth,n=t.label,o=t.drawLabelOptions;this.boxColor=e||"rgba(0, 0, 255, 1)",this.lineWidth=r||2,this.label=n;var i={anchorPosition:u.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new tn(Object.assign({},i,o))},ta=function(){function t(t,e){void 0===e&&(e={}),this.box=new O(t),this.options=new ti(e)}return t.prototype.draw=function(t){var e=tr(t),r=this.options,n=r.boxColor,o=r.lineWidth,i=this.box,a=i.x,s=i.y,c=i.width,u=i.height;e.strokeStyle=n,e.lineWidth=o,e.strokeRect(a,s,c,u);var f=this.options.label;f&&new to([f],{x:a-o/2,y:s},this.options.drawLabelOptions).draw(t)},t}();function ts(t,e){(Array.isArray(e)?e:[e]).forEach(function(e){var r=e instanceof B?e.score:X(e)?e.detection.score:void 0,n=e instanceof B?e.box:X(e)?e.detection.box:new O(e),o=r?""+P(r):void 0;new ta(n,{label:o}).draw(t)})}function tc(t){var e=tt.getEnv(),r=e.Image,n=e.Video;return t instanceof r&&t.complete||t instanceof n&&t.readyState>=3}function tu(t){var e=tt.getEnv(),r=e.Image,n=e.Video;return t instanceof r?new w(t.naturalWidth,t.naturalHeight):t instanceof n?new w(t.videoWidth,t.videoHeight):new w(t.width,t.height)}function tf(t){var e=t.width,r=t.height,n=(0,tt.getEnv().createCanvasElement)();return n.width=e,n.height=r,n}function th(t,e){var r=tt.getEnv().ImageData;if(!(t instanceof r)&&!tc(t))throw Error("createCanvasFromMedia - media has not finished loading yet");var n=e||tu(t),o=n.width,i=n.height,a=tf({width:o,height:i});return t instanceof r?tr(a).putImageData(t,0,0):tr(a).drawImage(t,0,0,o,i),a}function tp(t){var e=tt.getEnv(),r=e.Image,n=e.Canvas,o=e.Video;return t instanceof r||t instanceof n||t instanceof o}var tl=function(){function t(t,e){var r=this;if(void 0===e&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=e,this._batchSize=t.length,t.forEach(function(t,e){if(x(t,3)){r._imageTensors[e]=t,r._inputDimensions[e]=t.shape;return}if(E(t)){var n=t.shape[0];if(1!==n)throw Error("NetInput - tf.Tensor4D with batchSize "+n+" passed, but not supported in input array");r._imageTensors[e]=t,r._inputDimensions[e]=t.shape.slice(1);return}var o=t instanceof tt.getEnv().Canvas?t:th(t);r._canvases[e]=o,r._inputDimensions[e]=[o.height,o.width,3]})}return Object.defineProperty(t.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reshapedInputDimensions",{get:function(){var t=this;return T(this.batchSize,0,1).map(function(e,r){return t.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),t.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},t.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},t.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},t.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},t.prototype.getReshapedInputDimensions=function(t){var e,r,n,o,i;if("number"!=typeof this.inputSize)throw Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return e={width:this.getInputWidth(t),height:this.getInputHeight(t)},r=this.inputSize,n=e.width,i=r/Math.max(o=e.height,n),new w(Math.round(n*i),Math.round(o*i))},t.prototype.toBatchTensor=function(t,e){var r=this;return void 0===e&&(e=!0),this._inputSize=t,l.lub(function(){var n=T(r.batchSize,0,1).map(function(n){var o=r.getInput(n);if(o instanceof l.esB){var i,a,s=E(o)?o:o.expandDims();return i=s,void 0===(a=e)&&(a=!1),((s=l.lub(function(){var t=i.shape.slice(1),e=t[0],r=t[1];if(e===r)return i;var n=Math.abs(e-r),o=e>r?2:1,s=function(t){var e=i.shape.slice();return e[o]=t,l.hlL(e,0)},c=s(Math.round(n*(a?.5:1))),u=n-c.shape[o],f=[a&&u?s(u):null,i,c].filter(function(t){return!!t}).map(function(t){return t.toFloat()});return l.zoF(f,o)})).shape[1]!==t||s.shape[2]!==t)&&(s=l.BHj.resizeBilinear(s,[t,t])),s.as3D(t,t,3)}if(o instanceof tt.getEnv().Canvas)return l.Xhn.fromPixels(function(t,e,r){void 0===r&&(r=!1);var n=tt.getEnv(),o=n.Image,i=n.Canvas;if(!(t instanceof o||t instanceof i))throw Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=tu(t),s=e/Math.max(a.height,a.width),c=s*a.width,u=s*a.height,f=tf({width:e,height:e}),h=t instanceof i?t:th(t),p=Math.abs(c-u)/2,l=r&&c<u?p:0,d=r&&u<c?p:0;return tr(f).drawImage(h,l,d,c,u),f}(o,t,e));throw Error("toBatchTensor - at batchIdx "+n+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+o)});return l.knu(n.map(function(t){return t.toFloat()})).as4D(r.batchSize,t,t,3)})},t}();function td(t){return y(this,void 0,void 0,function(){var e,r,n;return b(this,function(o){switch(o.label){case 0:if(t instanceof tl)return[2,t];if(!(e=Array.isArray(t)?t:[t]).length)throw Error("toNetInput - empty array passed as input");return r=function(e){return Array.isArray(t)?" at input index "+e+":":""},(n=e.map(te)).forEach(function(t,n){if(!tp(t)&&!x(t,3)&&!E(t)){if("string"==typeof e[n])throw Error("toNetInput -"+r(n)+" string passed, but could not resolve HTMLElement for element id "+e[n]);throw Error("toNetInput -"+r(n)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(E(t)){var o=t.shape[0];if(1!==o)throw Error("toNetInput -"+r(n)+" tf.Tensor4D with batchSize "+o+" passed, but not supported in input array")}}),[4,Promise.all(n.map(function(t){return tp(t)&&new Promise(function(e,r){if(t instanceof tt.getEnv().Canvas||tc(t))return e();function n(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",n),t.currentTarget.removeEventListener("error",o),e(t))}function o(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",n),t.currentTarget.removeEventListener("error",o),r(t))}t.addEventListener("load",n),t.addEventListener("error",o)})}))];case 1:return o.sent(),[2,new tl(n,Array.isArray(t))]}})})}function tv(t,e){return y(this,void 0,void 0,function(){var r,n,o,i,a,s;return b(this,function(c){switch(c.label){case 0:if(r=tt.getEnv().Canvas,n=t,t instanceof r)return[3,5];return[4,td(t)];case 1:if((o=c.sent()).batchSize>1)throw Error("extractFaces - batchSize > 1 not supported");if(!((i=o.getInput(0))instanceof r))return[3,2];return a=i,[3,4];case 2:return[4,function(t,e){return y(this,void 0,void 0,function(){var e,r,n,o,i,a;return b(this,function(s){switch(s.label){case 0:return e=tt.getEnv().createCanvasElement(),n=(r=t.shape.slice(E(t)?1:0))[0],o=r[1],i=r[2],a=l.lub(function(){return t.as3D(n,o,i).toInt()}),[4,l.Xhn.toPixels(a,e)];case 1:return s.sent(),a.dispose(),[2,e]}})})}(i)];case 3:a=c.sent(),c.label=4;case 4:n=a,c.label=5;case 5:return s=tr(n),[2,e.map(function(t){return t instanceof B?t.forSize(n.width,n.height).box.floor():t}).map(function(t){return t.clipAtImageBorders(n.width,n.height)}).map(function(t){var e=t.x,r=t.y,n=t.width,o=t.height,i=tf({width:n,height:o});return tr(i).putImageData(s.getImageData(e,r,n,o),0,0),i})]}})})}function tm(t,e){return y(this,void 0,void 0,function(){return b(this,function(r){if(!x(t,3)&&!E(t))throw Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(E(t)&&t.shape[0]>1)throw Error("extractFaceTensors - batchSize > 1 not supported");return[2,l.lub(function(){var r=t.shape.slice(E(t)?1:0),n=r[0],o=r[1],i=r[2];return e.map(function(t){return t instanceof B?t.forSize(o,n).box:t}).map(function(t){return t.clipAtImageBorders(o,n)}).map(function(e){var r=e.x,a=e.y,s=e.width,c=e.height;return l.CnO(t.as3D(n,o,i),[a,r,0],[c,s,i])})})]})})}function tg(t,e){var r=e+"-weights_manifest.json";if(!t)return{modelBaseUri:"",manifestUri:r};if("/"===t)return{modelBaseUri:"/",manifestUri:"/"+r};var n=t.startsWith("http://")?"http://":t.startsWith("https://")?"https://":"",o=(t=t.replace(n,"")).split("/").filter(function(t){return t}),i=t.endsWith(".json")?o[o.length-1]:r,a=n+(t.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return{modelBaseUri:a=t.startsWith("/")?"/"+a:a,manifestUri:"/"===a?"/"+i:a+"/"+i}}function ty(t,e,r){void 0===r&&(r=!1);var n=r?tu(e):e,o=n.width,i=n.height;return t.width=o,t.height=i,{width:o,height:i}}var tb=function(){function t(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),t.prototype.getParamFromPath=function(t){var e=this.traversePropertyPath(t);return e.obj[e.objProp]},t.prototype.reassignParamFromPath=function(t,e){var r=this.traversePropertyPath(t),n=r.obj,o=r.objProp;n[o].dispose(),n[o]=e},t.prototype.getParamList=function(){var t=this;return this._paramMappings.map(function(e){var r=e.paramPath;return{path:r,tensor:t.getParamFromPath(r)}})},t.prototype.getTrainableParams=function(){return this.getParamList().filter(function(t){return t.tensor instanceof l._wD})},t.prototype.getFrozenParams=function(){return this.getParamList().filter(function(t){return!(t.tensor instanceof l._wD)})},t.prototype.variable=function(){var t=this;this.getFrozenParams().forEach(function(e){var r=e.path,n=e.tensor;t.reassignParamFromPath(r,n.variable())})},t.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach(function(e){var r=e.path,n=e.tensor,o=l.XeE(n.dataSync());n.dispose(),t.reassignParamFromPath(r,o)})},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.getParamList().forEach(function(e){if(t&&e.tensor.isDisposed)throw Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()}),this._params=void 0},t.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(t){return Array.from(t.tensor.dataSync())}).reduce(function(t,e){return t.concat(e)}))},t.prototype.load=function(t){return y(this,void 0,void 0,function(){return b(this,function(e){switch(e.label){case 0:if(t instanceof Float32Array)return this.extractWeights(t),[2];return[4,this.loadFromUri(t)];case 1:return e.sent(),[2]}})})},t.prototype.loadFromUri=function(t){return y(this,void 0,void 0,function(){var e;return b(this,function(r){switch(r.label){case 0:if(t&&"string"!=typeof t)throw Error(this._name+".loadFromUri - expected model uri");return[4,function(t,e){return y(this,void 0,void 0,function(){var r,n,o,i;return b(this,function(a){switch(a.label){case 0:return n=(r=tg(t,e)).manifestUri,o=r.modelBaseUri,[4,function(t){return y(this,void 0,void 0,function(){return b(this,function(e){switch(e.label){case 0:return[4,function(t,e){return y(this,void 0,void 0,function(){var e;return b(this,function(r){switch(r.label){case 0:return[4,(0,tt.getEnv().fetch)(t,void 0)];case 1:if(!((e=r.sent()).status<400))throw Error("failed to fetch: ("+e.status+") "+e.statusText+", from url: "+e.url);return[2,e]}})})}(t)];case 1:return[2,e.sent().json()]}})})}(n)];case 1:return i=a.sent(),[2,l.io.loadWeights(i,o)]}})})}(t,this.getDefaultModelName())];case 1:return e=r.sent(),this.loadFromWeightMap(e),[2]}})})},t.prototype.loadFromDisk=function(t){return y(this,void 0,void 0,function(){var e,r,n,o,i,a,s,c,u;return b(this,function(f){switch(f.label){case 0:if(t&&"string"!=typeof t)throw Error(this._name+".loadFromDisk - expected model file path");return e=tt.getEnv().readFile,n=(r=tg(t,this.getDefaultModelName())).manifestUri,o=r.modelBaseUri,i=function(t){return Promise.all(t.map(function(t){return e(t).then(function(t){return t.buffer})}))},a=l.io.weightsLoaderFactory(i),c=(s=JSON).parse,[4,e(n)];case 1:return[4,a(c.apply(s,[f.sent().toString()]),o)];case 2:return u=f.sent(),this.loadFromWeightMap(u),[2]}})})},t.prototype.loadFromWeightMap=function(t){var e=this.extractParamsFromWeigthMap(t),r=e.paramMappings,n=e.params;this._paramMappings=r,this._params=n},t.prototype.extractWeights=function(t){var e=this.extractParams(t),r=e.paramMappings,n=e.params;this._paramMappings=r,this._params=n},t.prototype.traversePropertyPath=function(t){if(!this.params)throw Error("traversePropertyPath - model has no loaded params");var e=t.split("/").reduce(function(e,r){if(!e.nextObj.hasOwnProperty(r))throw Error("traversePropertyPath - object does not have property "+r+", for path "+t);return{obj:e.nextObj,objProp:r,nextObj:e.nextObj[r]}},{nextObj:this.params}),r=e.obj,n=e.objProp;if(!r||!n||!(r[n]instanceof l.esB))throw Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:r,objProp:n}},t}();function t_(t,e,r){return l.lub(function(){var n=l.U_I(t,e.depthwise_filter,e.pointwise_filter,r,"same");return l.IHx(n,e.bias)})}function tw(t,e,r){return void 0===r&&(r=!1),l.lub(function(){var n=l.UYe(r?l.IHx(l.Tek(t,e.conv0.filters,[2,2],"same"),e.conv0.bias):t_(t,e.conv0,[2,2])),o=t_(n,e.conv1,[1,1]),i=t_(l.UYe(l.IHx(n,o)),e.conv2,[1,1]);return l.UYe(l.IHx(n,l.IHx(o,i)))})}function tx(t,e,r,n){return void 0===r&&(r=!1),void 0===n&&(n=!0),l.lub(function(){var o=l.UYe(r?l.IHx(l.Tek(t,e.conv0.filters,n?[2,2]:[1,1],"same"),e.conv0.bias):t_(t,e.conv0,n?[2,2]:[1,1])),i=t_(o,e.conv1,[1,1]),a=t_(l.UYe(l.IHx(o,i)),e.conv2,[1,1]),s=t_(l.UYe(l.IHx(o,l.IHx(i,a))),e.conv3,[1,1]);return l.UYe(l.IHx(o,l.IHx(i,l.IHx(a,s))))})}function tE(t,e,r,n){return void 0===r&&(r="same"),void 0===n&&(n=!1),l.lub(function(){var o=l.IHx(l.Tek(t,e.filters,[1,1],r),e.bias);return n?l.UYe(o):o})}function tP(t,e){Object.keys(t).forEach(function(r){e.some(function(t){return t.originalPath===r})||t[r].dispose()})}function tM(t,e){return function(r,n,o,i){var a=l.yXz(t(r*n*o*o),[o,o,r,n]),s=l.RRF(t(n));return e.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:s}}}function tS(t,e){return function(r,n,o){var i=l.odF(t(r*n),[r,n]),a=l.RRF(t(n));return e.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:i,bias:a}}}var tT=function(t,e,r){this.depthwise_filter=t,this.pointwise_filter=e,this.bias=r};function tF(t,e){return function(r,n,o){var i=l.yXz(t(9*r),[3,3,r,1]),a=l.yXz(t(r*n),[1,1,r,n]),s=l.RRF(t(n));return e.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new tT(i,a,s)}}function tC(t){return function(e){var r=t(e+"/depthwise_filter",4),n=t(e+"/pointwise_filter",4),o=t(e+"/bias",1);return new tT(r,n,o)}}function tI(t,e){return function(r,n,o){var i=t[r];if(!x(i,n))throw Error("expected weightMap["+r+"] to be a Tensor"+n+"D, instead have "+i);return e.push({originalPath:r,paramPath:o||r}),i}}function tO(t){var e=t;return{extractWeights:function(t){var r=e.slice(0,t);return e=e.slice(t),r},getRemainingWeights:function(){return e}}}function tD(t,e){var r=tM(t,e),n=tF(t,e);function o(t,e,o,i){return void 0===i&&(i=!1),{conv0:i?r(t,e,3,o+"/conv0"):n(t,e,o+"/conv0"),conv1:n(e,e,o+"/conv1"),conv2:n(e,e,o+"/conv2")}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:function(t,e,r,i){void 0===i&&(i=!1);var a=o(t,e,r,i);return{conv0:a.conv0,conv1:a.conv1,conv2:a.conv2,conv3:n(e,e,r+"/conv3")}}}}function tA(t){return function(e){return{filters:t(e+"/filters",4),bias:t(e+"/bias",1)}}}function tB(t,e){var r=tI(t,e),n=tA(r),o=tC(r);return{extractDenseBlock3Params:function(t,e){return void 0===e&&(e=!1),{conv0:e?n(t+"/conv0"):o(t+"/conv0"),conv1:o(t+"/conv1"),conv2:o(t+"/conv2")}},extractDenseBlock4Params:function(t,e){return void 0===e&&(e=!1),{conv0:e?n(t+"/conv0"):o(t+"/conv0"),conv1:o(t+"/conv1"),conv2:o(t+"/conv2"),conv3:o(t+"/conv3")}}}}var tL=function(t){function e(){return t.call(this,"FaceFeatureExtractor")||this}return m(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw Error("FaceFeatureExtractor - load model before inference");return l.lub(function(){var r=tx(k(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(l.iD$(255)),e.dense0,!0);return r=tx(r,e.dense1),r=tx(r,e.dense2),r=tx(r,e.dense3),r=l.wS1(r,[7,7],[2,2],"valid")})},e.prototype.forward=function(t){return y(this,void 0,void 0,function(){var e;return b(this,function(r){switch(r.label){case 0:return e=this.forwardInput,[4,td(t)];case 1:return[2,e.apply(this,[r.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){var e,r,n;return n={dense0:(r=tB(t,e=[]).extractDenseBlock4Params)("dense0",!0),dense1:r("dense1"),dense2:r("dense2"),dense3:r("dense3")},tP(t,e),{params:n,paramMappings:e}},e.prototype.extractParams=function(t){return function(t){var e=[],r=tO(t),n=r.extractWeights,o=r.getRemainingWeights,i=tD(n,e).extractDenseBlock4Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),c=i(64,128,"dense2"),u=i(128,256,"dense3");if(0!==o().length)throw Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:c,dense3:u}}}(t)},e}(tb);function tk(t,e){return l.lub(function(){return l.IHx(l.OI3(t,e.weights),e.bias)})}function tj(t){var e={},r={};return Object.keys(t).forEach(function(n){(n.startsWith("fc")?r:e)[n]=t[n]}),{featureExtractorMap:e,classifierMap:r}}var tR=function(t){function e(e,r){var n=t.call(this,e)||this;return n._faceFeatureExtractor=r,n}return m(e,t),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var e=this,r=this.params;if(!r)throw Error(this._name+" - load model before inference");return l.lub(function(){var n=t instanceof tl?e.faceFeatureExtractor.forwardInput(t):t;return tk(n.as2D(n.shape[0],-1),r.fc)})},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},e.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),r=e.params,n=e.paramMappings;this._params=r,this._paramMappings=n},e.prototype.extractClassifierParams=function(t){return function(t,e,r){var n=[],o=tO(t),i=o.extractWeights,a=o.getRemainingWeights,s=tS(i,n)(e,r,"fc");if(0!==a().length)throw Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{fc:s}}}(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var e,r,n,o=tj(t),i=o.featureExtractorMap,a=o.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),n={fc:{weights:(r=tI(a,e=[]))("fc/weights",2),bias:r("fc/bias",1)}},tP(a,e),{params:n,paramMappings:e}},e.prototype.extractParams=function(t){var e=this.getClassifierChannelsIn(),r=this.getClassifierChannelsOut(),n=r*e+r,o=t.slice(0,t.length-n),i=t.slice(t.length-n);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(i)},e}(tb),tU=["neutral","happy","sad","angry","fearful","disgusted","surprised"],tN=function(){function t(t){var e=this;if(7!==t.length)throw Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);tU.forEach(function(r,n){e[r]=t[n]})}return t.prototype.asSortedArray=function(){var t=this;return tU.map(function(e){return{expression:e,probability:t[e]}}).sort(function(t,e){return e.probability-t.probability})},t}(),tH=function(t){function e(e){return void 0===e&&(e=new tL),t.call(this,"FaceExpressionNet",e)||this}return m(e,t),e.prototype.forwardInput=function(t){var e=this;return l.lub(function(){return l.XAC(e.runNet(t))})},e.prototype.forward=function(t){return y(this,void 0,void 0,function(){var e;return b(this,function(r){switch(r.label){case 0:return e=this.forwardInput,[4,td(t)];case 1:return[2,e.apply(this,[r.sent()])]}})})},e.prototype.predictExpressions=function(t){return y(this,void 0,void 0,function(){var e,r,n,o,i=this;return b(this,function(a){switch(a.label){case 0:return[4,td(t)];case 1:return e=a.sent(),[4,this.forwardInput(e)];case 2:return r=a.sent(),[4,Promise.all(l.HHK(r).map(function(t){return y(i,void 0,void 0,function(){var e;return b(this,function(r){switch(r.label){case 0:return[4,t.data()];case 1:return e=r.sent(),t.dispose(),[2,e]}})})}))];case 3:return n=a.sent(),r.dispose(),o=n.map(function(t){return new tN(t)}),[2,e.isBatchInput?o:o[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(tR);function tz(t,e){return Object.assign({},t,{expressions:e})}function tW(t,e,r,n){void 0===r&&(r=.1),(Array.isArray(e)?e:[e]).forEach(function(e){var o=e instanceof tN?e:e.expressions instanceof tN?e.expressions:void 0;if(!o)throw Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var i=o.asSortedArray().filter(function(t){return t.probability>r}),a=X(e)?e.detection.box.bottomLeft:n||new I(0,0);new to(i.map(function(t){return t.expression+" ("+P(t.probability)+")"}),a).draw(t)})}function tY(t){return X(t)&&t.landmarks instanceof U&&t.unshiftedLandmarks instanceof U&&t.alignedRect instanceof B}function tX(t,e){var r=t.detection.box,n=e.shiftBy(r.x,r.y),o=n.align(),i=t.detection.imageDims,a=new B(t.detection.score,o.rescale(i.reverse()),i);return Object.assign({},t,{landmarks:n,unshiftedLandmarks:e,alignedRect:a})}var tG=function(t){void 0===t&&(t={});var e=t.drawLines,r=t.drawPoints,n=t.lineWidth,o=t.lineColor,i=t.pointSize,a=t.pointColor;this.drawLines=void 0===e||e,this.drawPoints=void 0===r||r,this.lineWidth=n||1,this.pointSize=i||2,this.lineColor=o||"rgba(0, 255, 255, 1)",this.pointColor=a||"rgba(255, 0, 255, 1)"},tV=function(){function t(t,e){void 0===e&&(e={}),this.faceLandmarks=t,this.options=new tG(e)}return t.prototype.draw=function(t){var e=tr(t),r=this.options,n=r.drawLines,o=r.drawPoints,i=r.lineWidth,a=r.lineColor,s=r.pointSize,c=r.pointColor;n&&this.faceLandmarks instanceof H&&(e.strokeStyle=a,e.lineWidth=i,d(e,this.faceLandmarks.getJawOutline()),d(e,this.faceLandmarks.getLeftEyeBrow()),d(e,this.faceLandmarks.getRightEyeBrow()),d(e,this.faceLandmarks.getNose()),d(e,this.faceLandmarks.getLeftEye(),!0),d(e,this.faceLandmarks.getRightEye(),!0),d(e,this.faceLandmarks.getMouth(),!0)),o&&(e.strokeStyle=c,e.fillStyle=c,this.faceLandmarks.positions.forEach(function(t){e.beginPath(),e.arc(t.x,t.y,s,0,2*Math.PI),e.fill()}))},t}();function tJ(t,e){(Array.isArray(e)?e:[e]).forEach(function(e){var r=e instanceof U?e:tY(e)?e.landmarks:void 0;if(!r)throw Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new tV(r).draw(t)})}function tq(t,e,r){return l.IHx(l.Tek(t,e.filters,r,"same"),e.bias)}function t$(t,e,r){void 0===r&&(r=!0);var n=r?l.UYe(t):t;return n=t_(n,e.separable_conv0,[1,1]),n=t_(l.UYe(n),e.separable_conv1,[1,1]),n=l._sB(n,[3,3],[2,2],"same"),n=l.IHx(n,tq(t,e.expansion_conv,[2,2]))}var tK=function(t){function e(e){var r=t.call(this,"TinyXception")||this;return r._numMainBlocks=e,r}return m(e,t),e.prototype.forwardInput=function(t){var e=this,r=this.params;if(!r)throw Error("TinyXception - load model before inference");return l.lub(function(){var n=k(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(l.iD$(256)),o=l.UYe(tq(n,r.entry_flow.conv_in,[2,2]));return o=t$(o,r.entry_flow.reduction_block_0,!1),o=t$(o,r.entry_flow.reduction_block_1),T(e._numMainBlocks,0,1).forEach(function(t){var e,n,i;e=o,n=r.middle_flow["main_block_"+t],i=t_(l.UYe(e),n.separable_conv0,[1,1]),i=t_(l.UYe(i),n.separable_conv1,[1,1]),i=t_(l.UYe(i),n.separable_conv2,[1,1]),o=i=l.IHx(i,e)}),o=t$(o,r.exit_flow.reduction_block),o=l.UYe(t_(o,r.exit_flow.separable_conv,[1,1]))})},e.prototype.forward=function(t){return y(this,void 0,void 0,function(){var e;return b(this,function(r){switch(r.label){case 0:return e=this.forwardInput,[4,td(t)];case 1:return[2,e.apply(this,[r.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t,e){var r,n,o,i=[],a={extractConvParams:n=tA(r=tI(t,i)),extractSeparableConvParams:o=tC(r),extractReductionBlockParams:function(t){return{separable_conv0:o(t+"/separable_conv0"),separable_conv1:o(t+"/separable_conv1"),expansion_conv:n(t+"/expansion_conv")}},extractMainBlockParams:function(t){return{separable_conv0:o(t+"/separable_conv0"),separable_conv1:o(t+"/separable_conv1"),separable_conv2:o(t+"/separable_conv2")}}},s=a.extractConvParams,c=a.extractSeparableConvParams,u=a.extractReductionBlockParams,f=a.extractMainBlockParams,h=s("entry_flow/conv_in"),p=u("entry_flow/reduction_block_0"),l=u("entry_flow/reduction_block_1"),d={};T(e,0,1).forEach(function(t){d["main_block_"+t]=f("middle_flow/main_block_"+t)});var v=u("exit_flow/reduction_block"),m=c("exit_flow/separable_conv");return tP(t,i),{params:{entry_flow:{conv_in:h,reduction_block_0:p,reduction_block_1:l},middle_flow:d,exit_flow:{reduction_block:v,separable_conv:m}},paramMappings:i}}(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return function(t,e){var r,n,o=[],i=tO(t),a=i.extractWeights,s=i.getRemainingWeights,c={extractConvParams:r=tM(a,o),extractSeparableConvParams:n=tF(a,o),extractReductionBlockParams:function(t,e,o){return{separable_conv0:n(t,e,o+"/separable_conv0"),separable_conv1:n(e,e,o+"/separable_conv1"),expansion_conv:r(t,e,1,o+"/expansion_conv")}},extractMainBlockParams:function(t,e){return{separable_conv0:n(t,t,e+"/separable_conv0"),separable_conv1:n(t,t,e+"/separable_conv1"),separable_conv2:n(t,t,e+"/separable_conv2")}}},u=c.extractConvParams,f=c.extractSeparableConvParams,h=c.extractReductionBlockParams,p=c.extractMainBlockParams,l=u(3,32,3,"entry_flow/conv_in"),d=h(32,64,"entry_flow/reduction_block_0"),v=h(64,128,"entry_flow/reduction_block_1"),m={};T(e,0,1).forEach(function(t){m["main_block_"+t]=p(128,"middle_flow/main_block_"+t)});var g=h(128,256,"exit_flow/reduction_block"),y=f(256,512,"exit_flow/separable_conv");if(0!==s().length)throw Error("weights remaing after extract: "+s().length);return{paramMappings:o,params:{entry_flow:{conv_in:l,reduction_block_0:d,reduction_block_1:v},middle_flow:m,exit_flow:{reduction_block:g,separable_conv:y}}}}(t,this._numMainBlocks)},e}(tb);(o=f||(f={})).FEMALE="female",o.MALE="male";var tQ=function(t){function e(e){void 0===e&&(e=new tK(2));var r=t.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=e,r}return m(e,t),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var e=this,r=this.params;if(!r)throw Error(this._name+" - load model before inference");return l.lub(function(){var n=t instanceof tl?e.faceFeatureExtractor.forwardInput(t):t,o=l.wS1(n,[7,7],[2,2],"valid").as2D(n.shape[0],-1);return{age:tk(o,r.fc.age).as1D(),gender:tk(o,r.fc.gender)}})},e.prototype.forwardInput=function(t){var e=this;return l.lub(function(){var r=e.runNet(t),n=r.age,o=r.gender;return{age:n,gender:l.XAC(o)}})},e.prototype.forward=function(t){return y(this,void 0,void 0,function(){var e;return b(this,function(r){switch(r.label){case 0:return e=this.forwardInput,[4,td(t)];case 1:return[2,e.apply(this,[r.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return y(this,void 0,void 0,function(){var e,r,n,o,i,a=this;return b(this,function(s){switch(s.label){case 0:return[4,td(t)];case 1:return e=s.sent(),[4,this.forwardInput(e)];case 2:return r=s.sent(),n=l.HHK(r.age),o=l.HHK(r.gender),[4,Promise.all(n.map(function(t,e){return{ageTensor:t,genderTensor:o[e]}}).map(function(t){var e=t.ageTensor,r=t.genderTensor;return y(a,void 0,void 0,function(){var t,n,o,i,a;return b(this,function(s){switch(s.label){case 0:return[4,e.data()];case 1:return t=s.sent()[0],[4,r.data()];case 2:return i=(o=(n=s.sent()[0])>.5)?f.MALE:f.FEMALE,a=o?n:1-n,e.dispose(),r.dispose(),[2,{age:t,gender:i,genderProbability:a}]}})})}))];case 3:return i=s.sent(),r.age.dispose(),r.gender.dispose(),[2,e.isBatchInput?i:i[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},e.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),r=e.params,n=e.paramMappings;this._params=r,this._paramMappings=n},e.prototype.extractClassifierParams=function(t){return function(t){var e=[],r=tO(t),n=r.extractWeights,o=r.getRemainingWeights,i=tS(n,e),a=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(0!==o().length)throw Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{fc:{age:a,gender:s}}}}(t)},e.prototype.extractParamsFromWeigthMap=function(t){var e=tj(t),r=e.featureExtractorMap,n=e.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(r),function(t){var e=[],r=tI(t,e);function n(t){return{weights:r(t+"/weights",2),bias:r(t+"/bias",1)}}var o={fc:{age:n("fc/age"),gender:n("fc/gender")}};return tP(t,e),{params:o,paramMappings:e}}(n)},e.prototype.extractParams=function(t){var e=t.slice(0,t.length-1539),r=t.slice(t.length-1539);return this.faceFeatureExtractor.extractWeights(e),this.extractClassifierParams(r)},e}(tb),tZ=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype.postProcess=function(t,e,r){var n=r.map(function(t){var r=t.width,n=t.height,o=e/Math.max(n,r);return{width:r*o,height:n*o}}),o=n.length;return l.lub(function(){var r=function(t,e){return l.knu([l.hlL([68],t),l.hlL([68],e)],1).as2D(1,136).as1D()},i=function(t,e){var r=n[t],o=r.width,i=r.height;return e(o,i)?Math.abs(o-i)/2:0};return t.mul(l.hlL([o,136],e)).sub(l.knu(Array.from(Array(o),function(t,e){return r(i(e,function(t,e){return t<e}),i(e,function(t,e){return e<t}))}))).div(l.knu(Array.from(Array(o),function(t,e){return r(n[e].width,n[e].height)})))})},e.prototype.forwardInput=function(t){var e=this;return l.lub(function(){var r=e.runNet(t);return e.postProcess(r,t.inputSize,t.inputDimensions.map(function(t){return{height:t[0],width:t[1]}}))})},e.prototype.forward=function(t){return y(this,void 0,void 0,function(){var e;return b(this,function(r){switch(r.label){case 0:return e=this.forwardInput,[4,td(t)];case 1:return[2,e.apply(this,[r.sent()])]}})})},e.prototype.detectLandmarks=function(t){return y(this,void 0,void 0,function(){var e,r,n,o=this;return b(this,function(i){switch(i.label){case 0:return[4,td(t)];case 1:return e=i.sent(),[4,Promise.all((r=l.lub(function(){return l.HHK(o.forwardInput(e))})).map(function(t,r){return y(o,void 0,void 0,function(){var n,o,i,a,s;return b(this,function(c){switch(c.label){case 0:return i=(o=Array).from,[4,t.data()];case 1:return a=(n=i.apply(o,[c.sent()])).filter(function(t,e){return e%2==0}),s=n.filter(function(t,e){return e%2!=0}),[2,new H(Array(68).fill(0).map(function(t,e){return new I(a[e],s[e])}),{height:e.getInputHeight(r),width:e.getInputWidth(r)})]}})})}))];case 2:return n=i.sent(),r.forEach(function(t){return t.dispose()}),[2,e.isBatchInput?n:n[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(tR),t0=function(t){function e(e){return void 0===e&&(e=new tL),t.call(this,"FaceLandmark68Net",e)||this}return m(e,t),e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(tZ),t1=function(t){function e(){return t.call(this,"TinyFaceFeatureExtractor")||this}return m(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw Error("TinyFaceFeatureExtractor - load model before inference");return l.lub(function(){var r=tw(k(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(l.iD$(255)),e.dense0,!0);return r=tw(r,e.dense1),r=tw(r,e.dense2),r=l.wS1(r,[14,14],[2,2],"valid")})},e.prototype.forward=function(t){return y(this,void 0,void 0,function(){var e;return b(this,function(r){switch(r.label){case 0:return e=this.forwardInput,[4,td(t)];case 1:return[2,e.apply(this,[r.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){var e,r,n;return n={dense0:(r=tB(t,e=[]).extractDenseBlock3Params)("dense0",!0),dense1:r("dense1"),dense2:r("dense2")},tP(t,e),{params:n,paramMappings:e}},e.prototype.extractParams=function(t){return function(t){var e=[],r=tO(t),n=r.extractWeights,o=r.getRemainingWeights,i=tD(n,e).extractDenseBlock3Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),c=i(64,128,"dense2");if(0!==o().length)throw Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:c}}}(t)},e}(tb),t2=function(t){function e(e){return void 0===e&&(e=new t1),t.call(this,"FaceLandmark68TinyNet",e)||this}return m(e,t),e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(tZ);function t4(t,e,r,n,o){void 0===o&&(o="same");var i,a,s=e.conv,c=s.filters,u=s.bias,f=l.Tek(t,c,r,o);return i=f=l.IHx(f,u),a=e.scale,f=l.IHx(l.dC7(i,a.weights),a.biases),n?l.UYe(f):f}function t3(t,e){return t4(t,e,[1,1],!1)}function t6(t,e){return t4(t,e,[2,2],!0,"valid")}function t5(t,e){var r=t4(t,e.conv1,[1,1],!0);return r=t3(r,e.conv2),r=l.IHx(r,t),r=l.UYe(r)}function t8(t,e){var r=t6(t,e.conv1);r=t3(r,e.conv2);var n=l.wS1(t,2,2,"valid"),o=l.lls(n.shape),i=n.shape[3]!==r.shape[3];if(n.shape[1]!==r.shape[1]||n.shape[2]!==r.shape[2]){var a=_(r.shape);a[1]=1;var s=l.lls(a),c=_((r=l.zoF([r,s],1)).shape);c[2]=1;var u=l.lls(c);r=l.zoF([r,u],2)}return n=i?l.zoF([n,o],3):n,r=l.IHx(n,r),r=l.UYe(r)}m(function(){return null!==i&&i.apply(this,arguments)||this},i=t0);var t7=function(t){function e(){return t.call(this,"FaceRecognitionNet")||this}return m(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw Error("FaceRecognitionNet - load model before inference");return l.lub(function(){var r=t6(k(t.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(l.iD$(256)),e.conv32_down);r=t5(r=l._sB(r,3,2,"valid"),e.conv32_1),r=t5(r,e.conv32_2),r=t8(r=t5(r,e.conv32_3),e.conv64_down),r=t5(r,e.conv64_1),r=t5(r,e.conv64_2),r=t8(r=t5(r,e.conv64_3),e.conv128_down),r=t5(r,e.conv128_1),r=t8(r=t5(r,e.conv128_2),e.conv256_down),r=t5(r,e.conv256_1);var n=(r=t8(r=t5(r,e.conv256_2),e.conv256_down_out)).mean([1,2]);return l.OI3(n,e.fc)})},e.prototype.forward=function(t){return y(this,void 0,void 0,function(){var e;return b(this,function(r){switch(r.label){case 0:return e=this.forwardInput,[4,td(t)];case 1:return[2,e.apply(this,[r.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return y(this,void 0,void 0,function(){var e,r,n,o=this;return b(this,function(i){switch(i.label){case 0:return[4,td(t)];case 1:return e=i.sent(),[4,Promise.all((r=l.lub(function(){return l.HHK(o.forwardInput(e))})).map(function(t){return t.data()}))];case 2:return n=i.sent(),r.forEach(function(t){return t.dispose()}),[2,e.isBatchInput?n:n[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],r=function(t,e){var r=tI(t,e);function n(t){return{conv:{filters:r(t+"/conv/filters",4),bias:r(t+"/conv/bias",1)},scale:{weights:r(t+"/scale/weights",1),biases:r(t+"/scale/biases",1)}}}return{extractConvLayerParams:n,extractResidualLayerParams:function(t){return{conv1:n(t+"/conv1"),conv2:n(t+"/conv2")}}}}(t,e),n=r.extractConvLayerParams,o=r.extractResidualLayerParams,i=n("conv32_down"),a=o("conv32_1"),s=o("conv32_2"),c=o("conv32_3"),u=o("conv64_down"),f=o("conv64_1"),h=o("conv64_2"),p=o("conv64_3"),l=o("conv128_down"),d=o("conv128_1"),v=o("conv128_2"),m=o("conv256_down"),g=o("conv256_1"),y=o("conv256_2"),b=o("conv256_down_out"),_=t.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!x(_,2))throw Error("expected weightMap[fc] to be a Tensor2D, instead have "+_);return tP(t,e),{params:{conv32_down:i,conv32_1:a,conv32_2:s,conv32_3:c,conv64_down:u,conv64_1:f,conv64_2:h,conv64_3:p,conv128_down:l,conv128_1:d,conv128_2:v,conv256_down:m,conv256_1:g,conv256_2:y,conv256_down_out:b,fc:_},paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=tO(t),r=e.extractWeights,n=e.getRemainingWeights,o=[],i=function(t,e){function r(r,n,o,i){var a,s,c,u,f,h;return{conv:(a=i+"/conv",s=function(e,r,n){var o=t(e),i=o.length/(r*n*n);if(i%1!=0)throw Error("depth has to be an integer: "+i+", weights.length: "+o.length+", numFilters: "+r+", filterSize: "+n);return l.lub(function(){return l.p4s(l.yXz(o,[r,i,n,n]),[2,3,1,0])})}(r,n,o),c=l.RRF(t(n)),e.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:s,bias:c}),scale:(u=i+"/scale",f=l.RRF(t(n)),h=l.RRF(t(n)),e.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:f,biases:h})}}return{extractConvLayerParams:r,extractResidualLayerParams:function(t,e,n,o,i){return void 0===i&&(i=!1),{conv1:r((i?.5:1)*t,e,n,o+"/conv1"),conv2:r(t,e,n,o+"/conv2")}}}}(r,o),a=i.extractConvLayerParams,s=i.extractResidualLayerParams,c=a(4704,32,7,"conv32_down"),u=s(9216,32,3,"conv32_1"),f=s(9216,32,3,"conv32_2"),h=s(9216,32,3,"conv32_3"),p=s(36864,64,3,"conv64_down",!0),d=s(36864,64,3,"conv64_1"),v=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),g=s(147456,128,3,"conv128_down",!0),y=s(147456,128,3,"conv128_1"),b=s(147456,128,3,"conv128_2"),_=s(589824,256,3,"conv256_down",!0),w=s(589824,256,3,"conv256_1"),x=s(589824,256,3,"conv256_2"),E=s(589824,256,3,"conv256_down_out"),P=l.lub(function(){return l.p4s(l.odF(r(32768),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),0!==n().length)throw Error("weights remaing after extract: "+n().length);return{params:{conv32_down:c,conv32_1:u,conv32_2:f,conv32_3:h,conv64_down:p,conv64_1:d,conv64_2:v,conv64_3:m,conv128_down:g,conv128_1:y,conv128_2:b,conv256_down:_,conv256_1:w,conv256_2:x,conv256_down_out:E,fc:P},paramMappings:o}}(t)},e}(tb);function t9(t,e,r){return Object.assign({},t,{gender:e,genderProbability:r})}var et=function(){function t(t){var e=void 0===t?{}:t,r=e.minFaceSize,n=e.scaleFactor,o=e.maxNumScales,i=e.scoreThresholds,a=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=n||.709,this._maxNumScales=o||10,this._scoreThresholds=i||[.6,.7,.7],this._scaleSteps=a,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(t){return"number"!=typeof t}))throw Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(t){return"number"!=typeof t})))throw Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(t.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),t}();function ee(t,e,r){return l.lub(function(){var n=l.Tek(t,e.filters,r,"same");return n=l.IHx(n,e.batch_norm_offset),l.iUl(n,0,6)})}function er(t,e){return l.lub(function(){var r=t.shape[0];return{boxPredictionEncoding:l.XLQ(tE(t,e.box_encoding_predictor),[r,-1,1,4]),classPrediction:l.XLQ(tE(t,e.class_predictor),[r,-1,3])}})}var en=function(){function t(t){var e=void 0===t?{}:t,r=e.minConfidence,n=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=n||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(t.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),t}(),eo=function(t){function e(){return t.call(this,"SsdMobilenetv1")||this}return m(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw Error("SsdMobilenetv1 - load model before inference");return l.lub(function(){var r,n,o,i,a,s,c=t.toBatchTensor(512,!1).toFloat(),u=(r=l.luU(l.dC7(c,l.iD$(.007843137718737125)),l.iD$(1)),n=e.mobilenetv1,l.lub(function(){var t=null,e=ee(r,n.conv_0,[2,2]);if([n.conv_1,n.conv_2,n.conv_3,n.conv_4,n.conv_5,n.conv_6,n.conv_7,n.conv_8,n.conv_9,n.conv_10,n.conv_11,n.conv_12,n.conv_13].forEach(function(r,n){var o,i,a=n+1,s=[2,4,6,12].some(function(t){return t===a})?[2,2]:[1,1];o=e,i=r.depthwise_conv,e=ee(e=l.lub(function(){var t=l.B10(o,i.filters,s,"same");return t=l.tgs(t,i.batch_norm_mean,i.batch_norm_variance,i.batch_norm_offset,i.batch_norm_scale,.0010000000474974513),l.iUl(t,0,6)}),r.pointwise_conv,[1,1]),11===a&&(t=e)}),null===t)throw Error("mobileNetV1 - output of conv layer 11 is null");return{out:e,conv11:t}})),f=(o=u.out,i=u.conv11,a=e.prediction_layer,l.lub(function(){var t=ee(o,a.conv_0,[1,1]),e=ee(t,a.conv_1,[2,2]),r=ee(e,a.conv_2,[1,1]),n=ee(r,a.conv_3,[2,2]),s=ee(n,a.conv_4,[1,1]),c=ee(s,a.conv_5,[2,2]),u=ee(c,a.conv_6,[1,1]),f=ee(u,a.conv_7,[2,2]),h=er(i,a.box_predictor_0),p=er(o,a.box_predictor_1),d=er(e,a.box_predictor_2),v=er(n,a.box_predictor_3),m=er(c,a.box_predictor_4),g=er(f,a.box_predictor_5);return{boxPredictions:l.zoF([h.boxPredictionEncoding,p.boxPredictionEncoding,d.boxPredictionEncoding,v.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding],1),classPredictions:l.zoF([h.classPrediction,p.classPrediction,d.classPrediction,v.classPrediction,m.classPrediction,g.classPrediction],1)}})),h=f.boxPredictions,p=f.classPredictions;return s=e.output_layer,l.lub(function(){var t,e,r,n,o,i,a,c,u,f,d,v,m,g=h.shape[0],y=(t=l.XLQ(l.Gg6(s.extra_dim,[g,1,1]),[-1,4]),e=l.XLQ(h,[-1,4]),a=(r=l.HHK(l.p4s(t,[1,0])),n=[l.luU(r[2],r[0]),l.luU(r[3],r[1])],o=[l.IHx(r[0],l.hiC(n[0],l.iD$(2))),l.IHx(r[1],l.hiC(n[1],l.iD$(2)))],i={sizes:n,centers:o}).sizes,c=i.centers,u=l.HHK(l.p4s(e,[1,0])),f=l.hiC(l.dC7(l.Qqt(l.hiC(u[2],l.iD$(5))),a[0]),l.iD$(2)),d=l.IHx(l.dC7(l.hiC(u[0],l.iD$(10)),a[0]),c[0]),v=l.hiC(l.dC7(l.Qqt(l.hiC(u[3],l.iD$(5))),a[1]),l.iD$(2)),m=l.IHx(l.dC7(l.hiC(u[1],l.iD$(10)),a[1]),c[1]),l.p4s(l.knu([l.luU(d,f),l.luU(m,v),l.IHx(d,f),l.IHx(m,v)]),[1,0]));y=l.XLQ(y,[g,y.shape[0]/g,4]);var b=l.XD2(l.tPi(p,[0,0,1],[-1,-1,-1])),_=l.tPi(b,[0,0,0],[-1,-1,1]);return _=l.XLQ(_,[g,_.shape[1]]),{boxes:l.HHK(y),scores:l.HHK(_)}})})},e.prototype.forward=function(t){return y(this,void 0,void 0,function(){var e;return b(this,function(r){switch(r.label){case 0:return e=this.forwardInput,[4,td(t)];case 1:return[2,e.apply(this,[r.sent()])]}})})},e.prototype.locateFaces=function(t,e){return void 0===e&&(e={}),y(this,void 0,void 0,function(){var r,n,o,i,a,s,c,u,f,h,p,l,d,v,m,g,y,_,w;return b(this,function(b){switch(b.label){case 0:return n=(r=new en(e)).maxResults,o=r.minConfidence,[4,td(t)];case 1:for(i=b.sent(),s=(a=this.forwardInput(i)).boxes,c=a.scores,u=s[0],f=c[0],h=1;h<s.length;h++)s[h].dispose(),c[h].dispose();return d=(l=Array).from,[4,f.data()];case 2:var x,E,P,M,S,T;return p=d.apply(l,[b.sent()]),x=u,E=n,P=o,M=Math.min(E,x.shape[0]),S=p.map(function(t,e){return{score:t,boxIndex:e}}).filter(function(t){return t.score>P}).sort(function(t,e){return e.score-t.score}),T=[],S.forEach(function(t){if(!(T.length>=M)){for(var e=t.score,r=T.length-1;r>=0;--r){var n=function(t,e,r){var n=t.arraySync(),o=Math.min(n[e][0],n[e][2]),i=Math.min(n[e][1],n[e][3]),a=Math.max(n[e][0],n[e][2]),s=Math.max(n[e][1],n[e][3]),c=Math.min(n[r][0],n[r][2]),u=Math.min(n[r][1],n[r][3]),f=Math.max(n[r][0],n[r][2]),h=Math.max(n[r][1],n[r][3]),p=(a-o)*(s-i),l=(f-c)*(h-u);if(p<=0||l<=0)return 0;var d=Math.max(Math.min(a,f)-Math.max(o,c),0)*Math.max(Math.min(s,h)-Math.max(i,u),0);return d/(p+l-d)}(x,t.boxIndex,T[r]);if(0!==n&&(t.score*=n<=.5?1:0,t.score<=P))break}e===t.score&&T.push(t.boxIndex)}}),v=i.getReshapedInputDimensions(0),g=(m=i.inputSize)/v.width,y=m/v.height,_=u.arraySync(),w=T.map(function(t){var e=[Math.max(0,_[t][0]),Math.min(1,_[t][2])].map(function(t){return t*y}),r=e[0],n=e[1],o=[Math.max(0,_[t][1]),Math.min(1,_[t][3])].map(function(t){return t*g}),a=o[0],s=o[1];return new B(p[t],new R(a,r,s-a,n-r),{height:i.getInputHeight(0),width:i.getInputWidth(0)})}),u.dispose(),f.dispose(),[2,w]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],r=function(t,e){var r=tI(t,e);function n(t,e,n){return{filters:r(t+"/Conv2d_"+e+"_pointwise/weights",4,n+"/filters"),batch_norm_offset:r(t+"/Conv2d_"+e+"_pointwise/convolution_bn_offset",1,n+"/batch_norm_offset")}}function o(t){var e="mobilenetv1/conv_"+t,o="MobilenetV1/Conv2d_"+t+"_depthwise",i=e+"/depthwise_conv";return{depthwise_conv:{filters:r(o+"/depthwise_weights",4,i+"/filters"),batch_norm_scale:r(o+"/BatchNorm/gamma",1,i+"/batch_norm_scale"),batch_norm_offset:r(o+"/BatchNorm/beta",1,i+"/batch_norm_offset"),batch_norm_mean:r(o+"/BatchNorm/moving_mean",1,i+"/batch_norm_mean"),batch_norm_variance:r(o+"/BatchNorm/moving_variance",1,i+"/batch_norm_variance")},pointwise_conv:n("MobilenetV1",t,e+"/pointwise_conv")}}function i(t,e){return{filters:r(t+"/weights",4,e+"/filters"),bias:r(t+"/biases",1,e+"/bias")}}function a(t){return{box_encoding_predictor:i("Prediction/BoxPredictor_"+t+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+t+"/box_encoding_predictor"),class_predictor:i("Prediction/BoxPredictor_"+t+"/ClassPredictor","prediction_layer/box_predictor_"+t+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:n("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}},extractPredictionLayerParams:function(){return{conv_0:n("Prediction",0,"prediction_layer/conv_0"),conv_1:n("Prediction",1,"prediction_layer/conv_1"),conv_2:n("Prediction",2,"prediction_layer/conv_2"),conv_3:n("Prediction",3,"prediction_layer/conv_3"),conv_4:n("Prediction",4,"prediction_layer/conv_4"),conv_5:n("Prediction",5,"prediction_layer/conv_5"),conv_6:n("Prediction",6,"prediction_layer/conv_6"),conv_7:n("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:a(0),box_predictor_1:a(1),box_predictor_2:a(2),box_predictor_3:a(3),box_predictor_4:a(4),box_predictor_5:a(5)}}}}(t,e),n=r.extractMobilenetV1Params,o=r.extractPredictionLayerParams,i=t["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!x(i,3))throw Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var a={mobilenetv1:n(),prediction_layer:o(),output_layer:{extra_dim:i}};return tP(t,e),{params:a,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=[],r=tO(t),n=r.extractWeights,o=r.getRemainingWeights,i=function(t,e){function r(r,n,o,i,a){var s=l.yXz(t(r*n*o*o),[o,o,r,n]),c=l.RRF(t(n));return e.push({paramPath:i+"/filters"},{paramPath:i+"/"+(a?"batch_norm_offset":"bias")}),{filters:s,bias:c}}function n(t,e,n,o){var i=r(t,e,n,o,!0);return{filters:i.filters,batch_norm_offset:i.bias}}function o(r,o,i){var a,s,c,u,f,h;return{depthwise_conv:(a=i+"/depthwise_conv",s=l.yXz(t(9*r),[3,3,r,1]),c=l.RRF(t(r)),u=l.RRF(t(r)),f=l.RRF(t(r)),h=l.RRF(t(r)),e.push({paramPath:a+"/filters"},{paramPath:a+"/batch_norm_scale"},{paramPath:a+"/batch_norm_offset"},{paramPath:a+"/batch_norm_mean"},{paramPath:a+"/batch_norm_variance"}),{filters:s,batch_norm_scale:c,batch_norm_offset:u,batch_norm_mean:f,batch_norm_variance:h}),pointwise_conv:n(r,o,1,i+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:n(3,32,3,"mobilenetv1/conv_0"),conv_1:o(32,64,"mobilenetv1/conv_1"),conv_2:o(64,128,"mobilenetv1/conv_2"),conv_3:o(128,128,"mobilenetv1/conv_3"),conv_4:o(128,256,"mobilenetv1/conv_4"),conv_5:o(256,256,"mobilenetv1/conv_5"),conv_6:o(256,512,"mobilenetv1/conv_6"),conv_7:o(512,512,"mobilenetv1/conv_7"),conv_8:o(512,512,"mobilenetv1/conv_8"),conv_9:o(512,512,"mobilenetv1/conv_9"),conv_10:o(512,512,"mobilenetv1/conv_10"),conv_11:o(512,512,"mobilenetv1/conv_11"),conv_12:o(512,1024,"mobilenetv1/conv_12"),conv_13:o(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:n(1024,256,1,"prediction_layer/conv_0"),conv_1:n(256,512,3,"prediction_layer/conv_1"),conv_2:n(512,128,1,"prediction_layer/conv_2"),conv_3:n(128,256,3,"prediction_layer/conv_3"),conv_4:n(256,128,1,"prediction_layer/conv_4"),conv_5:n(128,256,3,"prediction_layer/conv_5"),conv_6:n(256,64,1,"prediction_layer/conv_6"),conv_7:n(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:r(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:r(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:r(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:r(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:r(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}(n,e),a=i.extractMobilenetV1Params,s=i.extractPredictionLayerParams,c=a(),u=s(),f=l.wOQ(n(20472),[1,5118,4]);if(e.push({paramPath:"output_layer/extra_dim"}),0!==o().length)throw Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:c,prediction_layer:u,output_layer:{extra_dim:f}},paramMappings:e}}(t)},e}(tb);m(function(){return null!==a&&a.apply(this,arguments)||this},a=eo);var ei=[new I(.738768,.874946),new I(2.42204,2.65704),new I(4.30971,7.04493),new I(10.246,4.59428),new I(12.6868,11.8741)],ea=[new I(1.603231,2.094468),new I(6.041143,7.080126),new I(2.882459,3.518061),new I(4.266906,5.178857),new I(9.041765,10.66308)],es=[117.001,114.697,97.404],ec=function(t){return"number"==typeof t};function eu(t){return l.lub(function(){var e=l.dC7(t,l.iD$(.10000000149011612));return l.IHx(l.UYe(l.luU(t,e)),e)})}function ef(t,e){return l.lub(function(){var r=l.vku(t,[[0,0],[1,1],[1,1],[0,0]]);return r=l.Tek(r,e.conv.filters,[1,1],"valid"),r=l.luU(r,e.bn.sub),r=l.dC7(r,e.bn.truediv),eu(r=l.IHx(r,e.conv.bias))})}function eh(t,e){return l.lub(function(){var r=l.vku(t,[[0,0],[1,1],[1,1],[0,0]]);return r=l.U_I(r,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),eu(r=l.IHx(r,e.bias))})}(s=h||(h={}))[s.XS=224]="XS",s[s.SM=320]="SM",s[s.MD=416]="MD",s[s.LG=608]="LG";var ep=function(){function t(t){var e=void 0===t?{}:t,r=e.inputSize,n=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=n||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),t}(),el=function(t){function e(e){var r=t.call(this,"TinyYolov2")||this;return!function(t){if(!t)throw Error("invalid config: "+t);if("boolean"!=typeof t.withSeparableConvs)throw Error("config.withSeparableConvs has to be a boolean, have: "+t.withSeparableConvs);if(!ec(t.iouThreshold)||t.iouThreshold<0||t.iouThreshold>1)throw Error("config.iouThreshold has to be a number between [0, 1], have: "+t.iouThreshold);if(!Array.isArray(t.classes)||!t.classes.length||!t.classes.every(function(t){return"string"==typeof t}))throw Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(t.classes));if(!Array.isArray(t.anchors)||!t.anchors.length||!t.anchors.map(function(t){return t||{}}).every(function(t){return ec(t.x)&&ec(t.y)}))throw Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(t.anchors));if(t.meanRgb&&(!Array.isArray(t.meanRgb)||3!==t.meanRgb.length||!t.meanRgb.every(ec)))throw Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(t.meanRgb))}(e),r._config=e,r}return m(e,t),Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,e){var r=ef(t,e.conv0);return r=ef(r=l._sB(r,[2,2],[2,2],"same"),e.conv1),r=ef(r=l._sB(r,[2,2],[2,2],"same"),e.conv2),r=ef(r=l._sB(r,[2,2],[2,2],"same"),e.conv3),r=ef(r=l._sB(r,[2,2],[2,2],"same"),e.conv4),r=ef(r=l._sB(r,[2,2],[2,2],"same"),e.conv5),r=ef(r=l._sB(r,[2,2],[1,1],"same"),e.conv6),tE(r=ef(r,e.conv7),e.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,e){var r=this.config.isFirstLayerConv2d?eu(tE(t,e.conv0,"valid",!1)):eh(t,e.conv0);return r=eh(r=l._sB(r,[2,2],[2,2],"same"),e.conv1),r=eh(r=l._sB(r,[2,2],[2,2],"same"),e.conv2),r=eh(r=l._sB(r,[2,2],[2,2],"same"),e.conv3),r=eh(r=l._sB(r,[2,2],[2,2],"same"),e.conv4),r=eh(r=l._sB(r,[2,2],[2,2],"same"),e.conv5),r=l._sB(r,[2,2],[1,1],"same"),r=e.conv6?eh(r,e.conv6):r,tE(r=e.conv7?eh(r,e.conv7):r,e.conv8,"valid",!1)},e.prototype.forwardInput=function(t,e){var r=this,n=this.params;if(!n)throw Error("TinyYolov2 - load model before inference");return l.lub(function(){var o=t.toBatchTensor(e,!1).toFloat();return o=(o=r.config.meanRgb?k(o,r.config.meanRgb):o).div(l.iD$(256)),r.config.withSeparableConvs?r.runMobilenet(o,n):r.runTinyYolov2(o,n)})},e.prototype.forward=function(t,e){return y(this,void 0,void 0,function(){var r;return b(this,function(n){switch(n.label){case 0:return r=this.forwardInput,[4,td(t)];case 1:return[4,r.apply(this,[n.sent(),e])];case 2:return[2,n.sent()]}})})},e.prototype.detect=function(t,e){return void 0===e&&(e={}),y(this,void 0,void 0,function(){var r,n,o,i,a,s,c,u,f,h,p,d,v=this;return b(this,function(m){switch(m.label){case 0:return n=(r=new ep(e)).inputSize,o=r.scoreThreshold,[4,td(t)];case 1:return i=m.sent(),[4,this.forwardInput(i,n)];case 2:return a=m.sent(),s=l.lub(function(){return l.HHK(a)[0].expandDims()}),c={width:i.getInputWidth(0),height:i.getInputHeight(0)},[4,this.extractBoxes(s,i.getReshapedInputDimensions(0),o)];case 3:return u=m.sent(),a.dispose(),s.dispose(),f=u.map(function(t){return t.box}),h=u.map(function(t){return t.score}),p=u.map(function(t){return t.classScore}),d=u.map(function(t){return v.config.classes[t.label]}),[2,L(f.map(function(t){return t.rescale(n)}),h,this.config.iouThreshold,!0).map(function(t){return new A(h[t],p[t],d[t],f[t],c)})]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return function(t,e){var r,n=[],o=function(t,e){var r=tI(t,e);function n(t){return{filters:r(t+"/filters",4),bias:r(t+"/bias",1)}}return{extractConvParams:n,extractConvWithBatchNormParams:function(t){var e;return{conv:n(t+"/conv"),bn:{sub:r((e=t+"/bn")+"/sub",1),truediv:r(e+"/truediv",1)}}},extractSeparableConvParams:tC(r)}}(t,n),i=o.extractConvParams,a=o.extractConvWithBatchNormParams,s=o.extractSeparableConvParams;if(e.withSeparableConvs){var c=e.filterSizes&&e.filterSizes.length||9;r={conv0:e.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:c>7?s("conv6"):void 0,conv7:c>8?s("conv7"):void 0,conv8:i("conv8")}}else r={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:i("conv8")};return tP(t,n),{params:r,paramMappings:n}}(t,this.config)},e.prototype.extractParams=function(t){var r=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,n=r?r.length:void 0;if(7!==n&&8!==n&&9!==n)throw Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+n+" filterSizes in config");return function(t,e,r,n){var o,i,a=tO(t),s=a.extractWeights,c=a.getRemainingWeights,u=[],f={extractConvParams:o=tM(s,u),extractConvWithBatchNormParams:function(t,e,r){var n,i,a;return{conv:o(t,e,3,r+"/conv"),bn:(n=r+"/bn",i=l.RRF(s(e)),a=l.RRF(s(e)),u.push({paramPath:n+"/sub"},{paramPath:n+"/truediv"}),{sub:i,truediv:a})}},extractSeparableConvParams:tF(s,u)},h=f.extractConvParams,p=f.extractConvWithBatchNormParams,d=f.extractSeparableConvParams;if(e.withSeparableConvs){var v=n[0],m=n[1],g=n[2],y=n[3],b=n[4],_=n[5],w=n[6],x=n[7],E=n[8],P=e.isFirstLayerConv2d?h(v,m,3,"conv0"):d(v,m,"conv0"),M=d(m,g,"conv1"),S=d(g,y,"conv2"),T=d(y,b,"conv3"),F=d(b,_,"conv4"),C=d(_,w,"conv5"),I=x?d(w,x,"conv6"):void 0,O=E?d(x,E,"conv7"):void 0,D=h(E||x||w,5*r,1,"conv8");i={conv0:P,conv1:M,conv2:S,conv3:T,conv4:F,conv5:C,conv6:I,conv7:O,conv8:D}}else{var v=n[0],m=n[1],g=n[2],y=n[3],b=n[4],_=n[5],w=n[6],x=n[7],E=n[8],P=p(v,m,"conv0"),M=p(m,g,"conv1"),S=p(g,y,"conv2"),T=p(y,b,"conv3"),F=p(b,_,"conv4"),C=p(_,w,"conv5"),I=p(w,x,"conv6"),O=p(x,E,"conv7"),D=h(E,5*r,1,"conv8");i={conv0:P,conv1:M,conv2:S,conv3:T,conv4:F,conv5:C,conv6:I,conv7:O,conv8:D}}if(0!==c().length)throw Error("weights remaing after extract: "+c().length);return{params:i,paramMappings:u}}(t,this.config,this.boxEncodingSize,r)},e.prototype.extractBoxes=function(t,e,r){return y(this,void 0,void 0,function(){var n,o,i,a,s,c,u,f,h,p,d,v,m,y,_,w,x,E,P,M,S,T,F,C,I,O,A,B,L,k=this;return b(this,function(b){switch(b.label){case 0:return a=(i=Math.max(n=e.width,o=e.height))/n,s=i/o,c=t.shape[1],u=this.config.anchors.length,h=(f=l.lub(function(){var e=t.reshape([c,c,u,k.boxEncodingSize]);return[e.slice([0,0,0,0],[c,c,u,4]),e.slice([0,0,0,4],[c,c,u,1]),k.withClassScores?l.XAC(e.slice([0,0,0,5],[c,c,u,k.config.classes.length]),3):l.iD$(0)]}))[0],p=f[1],d=f[2],v=[],[4,p.array()];case 1:return m=b.sent(),[4,h.array()];case 2:y=b.sent(),_=0,b.label=3;case 3:if(!(_<c))return[3,12];w=0,b.label=4;case 4:if(!(w<c))return[3,11];x=0,b.label=5;case 5:if(!(x<u))return[3,10];if(E=j(m[_][w][x][0]),!(!r||E>r))return[3,9];if(P=(w+j(y[_][w][x][0]))/c*a,M=(_+j(y[_][w][x][1]))/c*s,S=Math.exp(y[_][w][x][2])*this.config.anchors[x].x/c*a,T=Math.exp(y[_][w][x][3])*this.config.anchors[x].y/c*s,F=P-S/2,C=M-T/2,I={row:_,col:w,anchor:x},!this.withClassScores)return[3,7];return[4,this.extractPredictedClass(d,I)];case 6:return L=b.sent(),[3,8];case 7:L={classScore:1,label:0},b.label=8;case 8:A=(O=L).classScore,B=O.label,v.push(g({box:new D(F,C,F+S,C+T),score:E,classScore:E*A,label:B},I)),b.label=9;case 9:return x++,[3,5];case 10:return w++,[3,4];case 11:return _++,[3,3];case 12:return h.dispose(),p.dispose(),d.dispose(),[2,v]}})})},e.prototype.extractPredictedClass=function(t,e){return y(this,void 0,void 0,function(){var r,n,o,i;return b(this,function(a){switch(a.label){case 0:return r=e.row,n=e.col,o=e.anchor,[4,t.array()];case 1:return i=a.sent(),[2,Array(this.config.classes.length).fill(0).map(function(t,e){return i[r][n][o][e]}).map(function(t,e){return{classScore:t,label:e}}).reduce(function(t,e){return t.classScore>e.classScore?t:e})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(tb),ed=function(t){function e(e){void 0===e&&(e=!0);var r=Object.assign({},{withSeparableConvs:e,iouThreshold:.4,classes:["face"]},e?{anchors:ea,meanRgb:es}:{anchors:ei,withClassScores:!0});return t.call(this,r)||this}return m(e,t),Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,e){return y(this,void 0,void 0,function(){return b(this,function(r){switch(r.label){case 0:return[4,this.detect(t,e)];case 1:return[2,r.sent().map(function(t){return new B(t.score,t.relativeBox,{width:t.imageWidth,height:t.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},e.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},e}(el),ev=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return m(e,t),e}(ep),em=function(){function t(){}return t.prototype.then=function(t){return y(this,void 0,void 0,function(){var e;return b(this,function(r){switch(r.label){case 0:return e=t,[4,this.run()];case 1:return[2,e.apply(void 0,[r.sent()])]}})})},t.prototype.run=function(){return y(this,void 0,void 0,function(){return b(this,function(t){throw Error("ComposableTask - run is not implemented")})})},t}();function eg(t,e){return Object.assign({},t,{descriptor:e})}function ey(t,e,r,n,o){return void 0===o&&(o=function(t){return t.alignedRect}),y(this,void 0,void 0,function(){var i,a,s,c,u;return b(this,function(f){switch(f.label){case 0:if(i=t.map(function(t){return tY(t)?o(t):t.detection}),s=n)return[3,5];if(!(e instanceof l.esB))return[3,2];return[4,tm(e,i)];case 1:return c=f.sent(),[3,4];case 2:return[4,tv(e,i)];case 3:c=f.sent(),f.label=4;case 4:s=c,f.label=5;case 5:return[4,r(a=s)];case 6:return u=f.sent(),a.forEach(function(t){return t instanceof l.esB&&t.dispose()}),[2,u]}})})}function eb(t,e,r,n,o){return y(this,void 0,void 0,function(){var i=this;return b(this,function(a){return[2,ey([t],e,function(t){return y(i,void 0,void 0,function(){return b(this,function(e){return[2,r(t[0])]})})},n,o)]})})}function e_(t,e){return{height:Math.floor(e[0]*t),width:Math.floor(e[1]*t)}}var ew=function(t){function e(e,r,n,o){return t.call(this,{left:e,top:r,right:n,bottom:o},!0)||this}return m(e,t),e}(O);function ex(t){return l.lub(function(){return l.dC7(l.luU(t,l.iD$(127.5)),l.iD$(.0078125))})}function eE(t,e){return l.lub(function(){return l.IHx(l.UYe(t),l.dC7(e,l.W76(l.UYe(l.W76(t)))))})}function eP(t,e,r){return void 0===r&&(r=!1),l.lub(function(){var n=tE(t,e.conv1,"valid");return n=eE(n,e.prelu1_alpha),n=eE(n=tE(n=l._sB(n,r?[2,2]:[3,3],[2,2],"same"),e.conv2,"valid"),e.prelu2_alpha),n=eE(n=tE(n=r?n:l._sB(n,[3,3],[2,2],"valid"),e.conv3,"valid"),e.prelu3_alpha)})}function eM(t,e,r){var n=r.width,o=r.height;return y(this,void 0,void 0,function(){var r,i,a,s=this;return b(this,function(c){switch(c.label){case 0:return r=tr(t),[4,Promise.all(e.map(function(e){return y(s,void 0,void 0,function(){var n,o,i,a,s,c,u,f;return b(this,function(h){return o=(n=e.padAtBorders(t.height,t.width)).y,i=n.ey,a=n.x,s=n.ex,c=a-1,u=o-1,f=r.getImageData(c,u,s-c,i-u),[2,tt.isNodejs()?th(f):createImageBitmap(f)]})})}))];case 1:return i=c.sent(),a=[],i.forEach(function(t){var e=tr(tf({width:n,height:o}));e.drawImage(t,0,0,n,o);for(var r=e.getImageData(0,0,n,o).data,i=[],s=0;s<r.length;s+=4)i.push(r[s+2]),i.push(r[s+1]),i.push(r[s]);a.push(i)}),[2,a.map(function(t){return l.lub(function(){return ex(l.p4s(l.yXz(t,[1,n,o,3]),[0,2,1,3]).toFloat())})})]}})})}var eS=function(t){function e(){return t.call(this,"Mtcnn")||this}return m(e,t),e.prototype.load=function(e){return y(this,void 0,void 0,function(){return b(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.load.call(this,e)]})})},e.prototype.loadFromDisk=function(e){return y(this,void 0,void 0,function(){return b(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.loadFromDisk.call(this,e)]})})},e.prototype.forwardInput=function(t,e){return void 0===e&&(e={}),y(this,void 0,void 0,function(){var r,n,o,i,a,s,c,u,f,h,p,d,v,m,g,_,w,x,E;return b(this,function(P){switch(P.label){case 0:if(!(r=this.params))throw Error("Mtcnn - load model before inference");if(!(n=t.canvases[0]))throw Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return o={},i=Date.now(),a=l.lub(function(){var t;return t=l.dt4(l.Xhn.fromPixels(n)).toFloat(),l.lub(function(){return l.knu(l.HHK(t,3).reverse(),3)})}),s=function(t){return a.dispose(),o.total=Date.now()-i,t},u=(c=a.shape.slice(1))[0],f=c[1],p=(h=new et(e)).minFaceSize,d=h.scaleFactor,v=h.maxNumScales,m=h.scoreThresholds,g=(h.scaleSteps||function(t,e,r){for(var n=r[0],o=r[1],i=12/t,a=[],s=Math.min(n,o)*i,c=0;s>=12;)a.push(i*Math.pow(e,c)),s*=e,c+=1;return a}(p,d,[u,f])).filter(function(t){var e=e_(t,[u,f]);return Math.min(e.width,e.height)>12}).slice(0,v),o.scales=g,o.pyramid=g.map(function(t){return e_(t,[u,f])}),_=Date.now(),[4,function(t,e,r,n,o){o.stage1=[];var i=e.map(function(e){return l.lub(function(){var r={scale:e},o=l.lub(function(){var r=e_(e,t.shape.slice(1)),n=r.height,o=r.width,i=ex(l.BHj.resizeBilinear(t,[n,o]));return l.p4s(i,[0,2,1,3])}),i=Date.now(),a=l.lub(function(){var t=eP(o,n,!0),e=tE(t,n.conv4_1,"valid"),r=l.dt4(l.Fp7(e,3),3);return{prob:l.XAC(l.luU(e,r),3),regions:tE(t,n.conv4_2,"valid")}}),s=a.prob,c=a.regions;return r.pnet=Date.now()-i,{scoresTensor:l.HHK(l.HHK(s,3)[1])[0],regionsTensor:l.HHK(c)[0],scale:e,statsForScale:r}})}).map(function(t){var e=t.scoresTensor,n=t.regionsTensor,i=t.scale,a=t.statsForScale,s=function(t,e,r,n){for(var o=[],i=t.arraySync(),a=0;a<t.shape[0];a++)for(var s=0;s<t.shape[1];s++)i[a][s]>=n&&o.push(new I(s,a));return o.map(function(t){var n=new D(Math.round((2*t.y+1)/r),Math.round((2*t.x+1)/r),Math.round((2*t.y+12)/r),Math.round((2*t.x+12)/r)),o=i[t.y][t.x],a=e.arraySync();return{cell:n,score:o,region:new ew(a[t.y][t.x][0],a[t.y][t.x][1],a[t.y][t.x][2],a[t.y][t.x][3])}})}(e,n,i,r);if(e.dispose(),n.dispose(),!s.length)return o.stage1.push(a),[];var c=Date.now(),u=L(s.map(function(t){return t.cell}),s.map(function(t){return t.score}),.5);return a.nms=Date.now()-c,a.numBoxes=u.length,o.stage1.push(a),u.map(function(t){return s[t]})}).reduce(function(t,e){return t.concat(e)},[]),a=[],s=[];if(i.length>0){var c=Date.now(),u=L(i.map(function(t){return t.cell}),i.map(function(t){return t.score}),.7);o.stage1_nms=Date.now()-c,s=u.map(function(t){return i[t].score}),a=u.map(function(t){return i[t]}).map(function(t){var e=t.cell,r=t.region;return new D(e.left+r.left*e.width,e.top+r.top*e.height,e.right+r.right*e.width,e.bottom+r.bottom*e.height).toSquare().round()})}return{boxes:a,scores:s}}(a,g,m[0],r.pnet,o)];case 1:if(w=P.sent(),o.total_stage1=Date.now()-_,!w.boxes.length)return[2,s({results:[],stats:o})];return o.stage2_numInputBoxes=w.boxes.length,_=Date.now(),[4,function(t,e,r,n,o){return y(this,void 0,void 0,function(){var i,a,s,c,u,f,h,p,d,v,m,g,y,_;return b(this,function(b){switch(b.label){case 0:return i=Date.now(),[4,eM(t,e,{width:24,height:24})];case 1:return a=b.sent(),o.stage2_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(t){var e=l.lub(function(){var e=eP(t,n),r=eE(tk(l.XLQ(e,[e.shape[0],n.fc1.weights.shape[0]]),n.fc1),n.prelu4_alpha),o=tk(r,n.fc2_1),i=l.dt4(l.Fp7(o,1),1),a=l.XAC(l.luU(o,i),1),s=tk(r,n.fc2_2);return{scores:l.HHK(a,1)[1],regions:s}});return t.dispose(),e}),o.stage2_rnet=Date.now()-i,c=s.length>1?l.zoF(s.map(function(t){return t.scores})):s[0].scores,h=(f=Array).from,[4,c.data()];case 2:return u=h.apply(f,[b.sent()]),c.dispose(),d=(p=u.map(function(t,e){return{score:t,idx:e}}).filter(function(t){return t.score>r}).map(function(t){return t.idx})).map(function(t){return e[t]}),v=p.map(function(t){return u[t]}),m=[],g=[],d.length>0&&(i=Date.now(),y=L(d,v,.7),o.stage2_nms=Date.now()-i,_=y.map(function(t){var e=s[p[t]].regions.arraySync();return new ew(e[0][0],e[0][1],e[0][2],e[0][3])}),g=y.map(function(t){return v[t]}),m=y.map(function(t,e){return d[t].calibrate(_[e])})),s.forEach(function(t){t.regions.dispose(),t.scores.dispose()}),[2,{boxes:m,scores:g}]}})})}(n,w.boxes,m[1],r.rnet,o)];case 2:if(x=P.sent(),o.total_stage2=Date.now()-_,!x.boxes.length)return[2,s({results:[],stats:o})];return o.stage3_numInputBoxes=x.boxes.length,_=Date.now(),[4,function(t,e,r,n,o){return y(this,void 0,void 0,function(){var i,a,s,c,u,f,h,p,d,v,m,g,y,_,w;return b(this,function(b){switch(b.label){case 0:return i=Date.now(),[4,eM(t,e,{width:48,height:48})];case 1:return a=b.sent(),o.stage3_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(t){var e=l.lub(function(){var e=eP(t,n);e=eE(e=tE(e=l._sB(e,[2,2],[2,2],"same"),n.conv4,"valid"),n.prelu4_alpha);var r=eE(tk(l.XLQ(e,[e.shape[0],n.fc1.weights.shape[0]]),n.fc1),n.prelu5_alpha),o=tk(r,n.fc2_1),i=l.dt4(l.Fp7(o,1),1),a=l.XAC(l.luU(o,i),1),s=tk(r,n.fc2_2),c=tk(r,n.fc2_3);return{scores:l.HHK(a,1)[1],regions:s,points:c}});return t.dispose(),e}),o.stage3_onet=Date.now()-i,c=s.length>1?l.zoF(s.map(function(t){return t.scores})):s[0].scores,h=(f=Array).from,[4,c.data()];case 2:return u=h.apply(f,[b.sent()]),c.dispose(),d=(p=u.map(function(t,e){return{score:t,idx:e}}).filter(function(t){return t.score>r}).map(function(t){return t.idx})).map(function(t){var e=s[t].regions.arraySync();return new ew(e[0][0],e[0][1],e[0][2],e[0][3])}),v=p.map(function(t,r){return e[t].calibrate(d[r])}),m=p.map(function(t){return u[t]}),g=[],y=[],_=[],v.length>0&&(i=Date.now(),w=L(v,m,.7,!1),o.stage3_nms=Date.now()-i,g=w.map(function(t){return v[t]}),y=w.map(function(t){return m[t]}),_=w.map(function(t,e){return[,,,,,].fill(0).map(function(r,n){var o=s[t].points.arraySync();return new I(o[0][n]*(g[e].width+1)+g[e].left,o[0][n+5]*(g[e].height+1)+g[e].top)})})),s.forEach(function(t){t.regions.dispose(),t.scores.dispose(),t.points.dispose()}),[2,{boxes:g,scores:y,points:_}]}})})}(n,x.boxes,m[2],r.onet,o)];case 3:return E=P.sent(),o.total_stage3=Date.now()-_,[2,s({results:E.boxes.map(function(t,e){return tX(G({},new B(E.scores[e],new R(t.left/f,t.top/u,t.width/f,t.height/u),{height:u,width:f})),new N(E.points[e].map(function(e){return e.sub(new I(t.left,t.top)).div(new I(t.width,t.height))}),{width:t.width,height:t.height}))}),stats:o})]}})})},e.prototype.forward=function(t,e){return void 0===e&&(e={}),y(this,void 0,void 0,function(){var r;return b(this,function(n){switch(n.label){case 0:return r=this.forwardInput,[4,td(t)];case 1:return[4,r.apply(this,[n.sent(),e])];case 2:return[2,n.sent().results]}})})},e.prototype.forwardWithStats=function(t,e){return void 0===e&&(e={}),y(this,void 0,void 0,function(){var r;return b(this,function(n){switch(n.label){case 0:return r=this.forwardInput,[4,td(t)];case 1:return[2,r.apply(this,[n.sent(),e])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){var e,r,n,o,i,a,s,c;return n=(r=function(t,e){var r=tI(t,e);function n(t){return{filters:r(t+"/weights",4,t+"/filters"),bias:r(t+"/bias",1)}}function o(t){return{weights:r(t+"/weights",2),bias:r(t+"/bias",1)}}function i(t){return{conv1:n(t+"/conv1"),prelu1_alpha:r(t+"/prelu1_alpha",1),conv2:n(t+"/conv2"),prelu2_alpha:r(t+"/prelu2_alpha",1),conv3:n(t+"/conv3"),prelu3_alpha:r(t+"/prelu3_alpha",1)}}return{extractPNetParams:function(){var t=i("pnet"),e=n("pnet/conv4_1"),r=n("pnet/conv4_2");return g(g({},t),{conv4_1:e,conv4_2:r})},extractRNetParams:function(){var t=i("rnet"),e=o("rnet/fc1"),n=r("rnet/prelu4_alpha",1),a=o("rnet/fc2_1"),s=o("rnet/fc2_2");return g(g({},t),{fc1:e,prelu4_alpha:n,fc2_1:a,fc2_2:s})},extractONetParams:function(){var t=i("onet"),e=n("onet/conv4"),a=r("onet/prelu4_alpha",1),s=o("onet/fc1"),c=r("onet/prelu5_alpha",1),u=o("onet/fc2_1"),f=o("onet/fc2_2"),h=o("onet/fc2_3");return g(g({},t),{conv4:e,prelu4_alpha:a,fc1:s,prelu5_alpha:c,fc2_1:u,fc2_2:f,fc2_3:h})}}}(t,e=[])).extractPNetParams,o=r.extractRNetParams,i=r.extractONetParams,a=n(),s=o(),c=i(),tP(t,e),{params:{pnet:a,rnet:s,onet:c},paramMappings:e}},e.prototype.extractParams=function(t){return function(t){var e=tO(t),r=e.extractWeights,n=e.getRemainingWeights,o=[],i=function(t,e){var r=tM(t,e),n=tS(t,e);function o(r,n){var o=l.RRF(t(r));return e.push({paramPath:n}),o}function i(t,e,n){return void 0===n&&(n=!1),{conv1:r(t[0],t[1],3,e+"/conv1"),prelu1_alpha:o(t[1],e+"/prelu1_alpha"),conv2:r(t[1],t[2],3,e+"/conv2"),prelu2_alpha:o(t[2],e+"/prelu2_alpha"),conv3:r(t[2],t[3],n?2:3,e+"/conv3"),prelu3_alpha:o(t[3],e+"/prelu3_alpha")}}return{extractPNetParams:function(){var t=i([3,10,16,32],"pnet"),e=r(32,2,1,"pnet/conv4_1"),n=r(32,4,1,"pnet/conv4_2");return g(g({},t),{conv4_1:e,conv4_2:n})},extractRNetParams:function(){var t=i([3,28,48,64],"rnet",!0),e=n(576,128,"rnet/fc1"),r=o(128,"rnet/prelu4_alpha"),a=n(128,2,"rnet/fc2_1"),s=n(128,4,"rnet/fc2_2");return g(g({},t),{fc1:e,prelu4_alpha:r,fc2_1:a,fc2_2:s})},extractONetParams:function(){var t=i([3,32,64,64],"onet"),e=r(64,128,2,"onet/conv4"),a=o(128,"onet/prelu4_alpha"),s=n(1152,256,"onet/fc1"),c=o(256,"onet/prelu5_alpha"),u=n(256,2,"onet/fc2_1"),f=n(256,4,"onet/fc2_2"),h=n(256,10,"onet/fc2_3");return g(g({},t),{conv4:e,prelu4_alpha:a,fc1:s,prelu5_alpha:c,fc2_1:u,fc2_2:f,fc2_3:h})}}}(r,o),a=i.extractPNetParams,s=i.extractRNetParams,c=i.extractONetParams,u=a(),f=s(),h=c();if(0!==n().length)throw Error("weights remaing after extract: "+n().length);return{params:{pnet:u,rnet:f,onet:h},paramMappings:o}}(t)},e}(tb),eT=[new I(1.603231,2.094468),new I(6.041143,7.080126),new I(2.882459,3.518061),new I(4.266906,5.178857),new I(9.041765,10.66308)],eF=[117.001,114.697,97.404],eC=function(t){function e(){return t.call(this,{withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:eT,meanRgb:eF,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]})||this}return m(e,t),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,e){return y(this,void 0,void 0,function(){return b(this,function(r){switch(r.label){case 0:return[4,this.detect(t,e)];case 1:return[2,r.sent().map(function(t){return new B(t.score,t.relativeBox,{width:t.imageWidth,height:t.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},e}(el),eI={ssdMobilenetv1:new eo,tinyFaceDetector:new eC,tinyYolov2:new ed,mtcnn:new eS,faceLandmark68Net:new t0,faceLandmark68TinyNet:new t2,faceRecognitionNet:new t7,faceExpressionNet:new tH,ageGenderNet:new tQ};function eO(t,e){return Object.assign({},t,{age:e})}var eD=function(t){function e(e,r,n){var o=t.call(this)||this;return o.parentTask=e,o.input=r,o.extractedFaces=n,o}return m(e,t),e}(em),eA=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype.run=function(){return y(this,void 0,void 0,function(){var t,e,r=this;return b(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return[4,ey(t=n.sent(),this.input,function(t){return y(r,void 0,void 0,function(){return b(this,function(e){switch(e.label){case 0:return[4,Promise.all(t.map(function(t){return eI.faceExpressionNet.predictExpressions(t)}))];case 1:return[2,e.sent()]}})})},this.extractedFaces)];case 2:return e=n.sent(),[2,t.map(function(t,r){return tz(t,e[r])})]}})})},e.prototype.withAgeAndGender=function(){return new eR(this,this.input)},e}(eD),eB=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype.run=function(){return y(this,void 0,void 0,function(){var t;return b(this,function(e){switch(e.label){case 0:return[4,this.parentTask];case 1:if(!(t=e.sent()))return[2];return[4,eb(t,this.input,function(t){return eI.faceExpressionNet.predictExpressions(t)},this.extractedFaces)];case 2:return[2,tz(t,e.sent())]}})})},e.prototype.withAgeAndGender=function(){return new eU(this,this.input)},e}(eD),eL=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype.withAgeAndGender=function(){return new eN(this,this.input)},e.prototype.withFaceDescriptors=function(){return new eW(this,this.input)},e}(eA),ek=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype.withAgeAndGender=function(){return new eH(this,this.input)},e.prototype.withFaceDescriptor=function(){return new eY(this,this.input)},e}(eB),ej=function(t){function e(e,r,n){var o=t.call(this)||this;return o.parentTask=e,o.input=r,o.extractedFaces=n,o}return m(e,t),e}(em),eR=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype.run=function(){return y(this,void 0,void 0,function(){var t,e,r=this;return b(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return[4,ey(t=n.sent(),this.input,function(t){return y(r,void 0,void 0,function(){return b(this,function(e){switch(e.label){case 0:return[4,Promise.all(t.map(function(t){return eI.ageGenderNet.predictAgeAndGender(t)}))];case 1:return[2,e.sent()]}})})},this.extractedFaces)];case 2:return e=n.sent(),[2,t.map(function(t,r){var n=e[r],o=n.age;return eO(t9(t,n.gender,n.genderProbability),o)})]}})})},e.prototype.withFaceExpressions=function(){return new eA(this,this.input)},e}(ej),eU=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype.run=function(){return y(this,void 0,void 0,function(){var t,e,r;return b(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:if(!(t=n.sent()))return[2];return[4,eb(t,this.input,function(t){return eI.ageGenderNet.predictAgeAndGender(t)},this.extractedFaces)];case 2:return r=(e=n.sent()).age,[2,eO(t9(t,e.gender,e.genderProbability),r)]}})})},e.prototype.withFaceExpressions=function(){return new eB(this,this.input)},e}(ej),eN=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype.withFaceExpressions=function(){return new eL(this,this.input)},e.prototype.withFaceDescriptors=function(){return new eW(this,this.input)},e}(eR),eH=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype.withFaceExpressions=function(){return new ek(this,this.input)},e.prototype.withFaceDescriptor=function(){return new eY(this,this.input)},e}(eU),ez=function(t){function e(e,r){var n=t.call(this)||this;return n.parentTask=e,n.input=r,n}return m(e,t),e}(em),eW=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype.run=function(){return y(this,void 0,void 0,function(){var t;return b(this,function(e){switch(e.label){case 0:return[4,this.parentTask];case 1:return[4,ey(t=e.sent(),this.input,function(t){return Promise.all(t.map(function(t){return eI.faceRecognitionNet.computeFaceDescriptor(t)}))},null,function(t){return t.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,e.sent().map(function(e,r){return eg(t[r],e)})]}})})},e.prototype.withFaceExpressions=function(){return new eL(this,this.input)},e.prototype.withAgeAndGender=function(){return new eN(this,this.input)},e}(ez),eY=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype.run=function(){return y(this,void 0,void 0,function(){var t;return b(this,function(e){switch(e.label){case 0:return[4,this.parentTask];case 1:if(!(t=e.sent()))return[2];return[4,eb(t,this.input,function(t){return eI.faceRecognitionNet.computeFaceDescriptor(t)},null,function(t){return t.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,eg(t,e.sent())]}})})},e.prototype.withFaceExpressions=function(){return new ek(this,this.input)},e.prototype.withAgeAndGender=function(){return new eH(this,this.input)},e}(ez),eX=function(t){function e(e,r,n){var o=t.call(this)||this;return o.parentTask=e,o.input=r,o.useTinyLandmarkNet=n,o}return m(e,t),Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?eI.faceLandmark68TinyNet:eI.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(em),eG=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype.run=function(){return y(this,void 0,void 0,function(){var t,e,r,n,o,i=this;return b(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:if(e=(t=a.sent()).map(function(t){return t.detection}),!(this.input instanceof l.esB))return[3,3];return[4,tm(this.input,e)];case 2:return n=a.sent(),[3,5];case 3:return[4,tv(this.input,e)];case 4:n=a.sent(),a.label=5;case 5:return[4,Promise.all((r=n).map(function(t){return i.landmarkNet.detectLandmarks(t)}))];case 6:return o=a.sent(),r.forEach(function(t){return t instanceof l.esB&&t.dispose()}),[2,t.map(function(t,e){return tX(t,o[e])})]}})})},e.prototype.withFaceExpressions=function(){return new eL(this,this.input)},e.prototype.withAgeAndGender=function(){return new eN(this,this.input)},e.prototype.withFaceDescriptors=function(){return new eW(this,this.input)},e}(eX),eV=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype.run=function(){return y(this,void 0,void 0,function(){var t,e,r,n,o;return b(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:if(!(t=i.sent()))return[2];if(e=t.detection,!(this.input instanceof l.esB))return[3,3];return[4,tm(this.input,[e])];case 2:return n=i.sent(),[3,5];case 3:return[4,tv(this.input,[e])];case 4:n=i.sent(),i.label=5;case 5:return r=n,[4,this.landmarkNet.detectLandmarks(r[0])];case 6:return o=i.sent(),r.forEach(function(t){return t instanceof l.esB&&t.dispose()}),[2,tX(t,o)]}})})},e.prototype.withFaceExpressions=function(){return new ek(this,this.input)},e.prototype.withAgeAndGender=function(){return new eH(this,this.input)},e.prototype.withFaceDescriptor=function(){return new eY(this,this.input)},e}(eX),eJ=function(t){function e(e,r){void 0===r&&(r=new en);var n=t.call(this)||this;return n.input=e,n.options=r,n}return m(e,t),e}(em),eq=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype.run=function(){return y(this,void 0,void 0,function(){var t,e,r,n;return b(this,function(o){switch(o.label){case 0:if(t=this,e=t.input,!((r=t.options)instanceof et))return[3,2];return[4,eI.mtcnn.forward(e,r)];case 1:return[2,o.sent().map(function(t){return t.detection})];case 2:if(!(n=r instanceof ev?function(t){return eI.tinyFaceDetector.locateFaces(t,r)}:r instanceof en?function(t){return eI.ssdMobilenetv1.locateFaces(t,r)}:r instanceof ep?function(t){return eI.tinyYolov2.locateFaces(t,r)}:null))throw Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,n(e)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(e){return y(t,void 0,void 0,function(){return b(this,function(t){switch(t.label){case 0:return[4,this.run()];case 1:return[2,e(t.sent().map(function(t){return G({},t)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new eG(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new eA(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new eR(this.runAndExtendWithFaceDetections(),this.input)},e}(eJ);function e$(t,e){return void 0===e&&(e=new en),new eq(t,e)}!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}m(e,t),e.prototype.run=function(){return y(this,void 0,void 0,function(){var t,e;return b(this,function(r){switch(r.label){case 0:return[4,new eq(this.input,this.options)];case 1:return e=(t=r.sent())[0],t.forEach(function(t){t.score>e.score&&(e=t)}),[2,e]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(e){return y(t,void 0,void 0,function(){var t;return b(this,function(r){switch(r.label){case 0:return[4,this.run()];case 1:return[2,e((t=r.sent())?G({},t):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new eV(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new eB(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new eU(this.runAndExtendWithFaceDetection(),this.input)}}(eJ),function(){function t(t,e){void 0===e&&(e=.6),this._distanceThreshold=e;var r=Array.isArray(t)?t:[t];if(!r.length)throw Error("FaceRecognizer.constructor - expected atleast one input");var n=1,o=function(){return"person "+n++};this._labeledDescriptors=r.map(function(t){if(t instanceof Y)return t;if(t instanceof Float32Array)return new Y(o(),[t]);if(t.descriptor&&t.descriptor instanceof Float32Array)return new Y(o(),[t.descriptor]);throw Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}Object.defineProperty(t.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),t.prototype.computeMeanDistance=function(t,e){return e.map(function(e){return function(t,e){if(t.length!==e.length)throw Error("euclideanDistance: arr1.length !== arr2.length");var r=Array.from(t),n=Array.from(e);return Math.sqrt(r.map(function(t,e){return t-n[e]}).reduce(function(t,e){return t+Math.pow(e,2)},0))}(e,t)}).reduce(function(t,e){return t+e},0)/(e.length||1)},t.prototype.matchDescriptor=function(t){var e=this;return this.labeledDescriptors.map(function(r){var n=r.descriptors,o=r.label;return new z(o,e.computeMeanDistance(t,n))}).reduce(function(t,e){return t.distance<e.distance?t:e})},t.prototype.findBestMatch=function(t){var e=this.matchDescriptor(t);return e.distance<this.distanceThreshold?e:new z("unknown",e.distance)},t.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(t){return t.toJSON()})}},t.fromJSON=function(e){var r=e.labeledDescriptors.map(function(t){return Y.fromJSON(t)});return new t(r,e.distanceThreshold)}}()},3454:function(t,e,r){"use strict";var n,o;t.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(o=r.g.process)?void 0:o.env)?r.g.process:r(7663)},1876:function(t){!function(){var e={675:function(t,e){"use strict";e.byteLength=function(t){var e=c(t),r=e[0],n=e[1];return(r+n)*3/4-n},e.toByteArray=function(t){var e,r,i=c(t),a=i[0],s=i[1],u=new o((a+s)*3/4-s),f=0,h=s>0?a-4:a;for(r=0;r<h;r+=4)e=n[t.charCodeAt(r)]<<18|n[t.charCodeAt(r+1)]<<12|n[t.charCodeAt(r+2)]<<6|n[t.charCodeAt(r+3)],u[f++]=e>>16&255,u[f++]=e>>8&255,u[f++]=255&e;return 2===s&&(e=n[t.charCodeAt(r)]<<2|n[t.charCodeAt(r+1)]>>4,u[f++]=255&e),1===s&&(e=n[t.charCodeAt(r)]<<10|n[t.charCodeAt(r+1)]<<4|n[t.charCodeAt(r+2)]>>2,u[f++]=e>>8&255,u[f++]=255&e),u},e.fromByteArray=function(t){for(var e,n=t.length,o=n%3,i=[],a=0,s=n-o;a<s;a+=16383)i.push(function(t,e,n){for(var o,i=[],a=e;a<n;a+=3)i.push(r[(o=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]))>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return i.join("")}(t,a,a+16383>s?s:a+16383));return 1===o?i.push(r[(e=t[n-1])>>2]+r[e<<4&63]+"=="):2===o&&i.push(r[(e=(t[n-2]<<8)+t[n-1])>>10]+r[e>>4&63]+r[e<<2&63]+"="),i.join("")};for(var r=[],n=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,s=i.length;a<s;++a)r[a]=i[a],n[i.charCodeAt(a)]=a;function c(t){var e=t.length;if(e%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");-1===r&&(r=e);var n=r===e?0:4-r%4;return[r,n]}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},72:function(t,e,r){"use strict";/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var n=r(675),o=r(783),i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(t){if(t>2147483647)throw RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return Object.setPrototypeOf(e,s.prototype),e}function s(t,e,r){if("number"==typeof t){if("string"==typeof e)throw TypeError('The "string" argument must be of type string. Received type number');return f(t)}return c(t,e,r)}function c(t,e,r){if("string"==typeof t)return function(t,e){if(("string"!=typeof e||""===e)&&(e="utf8"),!s.isEncoding(e))throw TypeError("Unknown encoding: "+e);var r=0|l(t,e),n=a(r),o=n.write(t,e);return o!==r&&(n=n.slice(0,o)),n}(t,e);if(ArrayBuffer.isView(t))return h(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(C(t,ArrayBuffer)||t&&C(t.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(C(t,SharedArrayBuffer)||t&&C(t.buffer,SharedArrayBuffer)))return function(t,e,r){var n;if(e<0||t.byteLength<e)throw RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r),s.prototype),n}(t,e,r);if("number"==typeof t)throw TypeError('The "value" argument must not be of type number. Received type number');var n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return s.from(n,e,r);var o=function(t){if(s.isBuffer(t)){var e,r=0|p(t.length),n=a(r);return 0===n.length||t.copy(n,0,0,r),n}return void 0!==t.length?"number"!=typeof t.length||(e=t.length)!=e?a(0):h(t):"Buffer"===t.type&&Array.isArray(t.data)?h(t.data):void 0}(t);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return s.from(t[Symbol.toPrimitive]("string"),e,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function u(t){if("number"!=typeof t)throw TypeError('"size" argument must be of type number');if(t<0)throw RangeError('The value "'+t+'" is invalid for option "size"')}function f(t){return u(t),a(t<0?0:0|p(t))}function h(t){for(var e=t.length<0?0:0|p(t.length),r=a(e),n=0;n<e;n+=1)r[n]=255&t[n];return r}function p(t){if(t>=2147483647)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|t}function l(t,e){if(s.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||C(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var r=t.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var o=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return M(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return T(t).length;default:if(o)return n?-1:M(t).length;e=(""+e).toLowerCase(),o=!0}}function d(t,e,r){var o,i,a=!1;if((void 0===e||e<0)&&(e=0),e>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(e>>>=0)))return"";for(t||(t="utf8");;)switch(t){case"hex":return function(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var o="",i=e;i<r;++i)o+=I[t[i]];return o}(this,e,r);case"utf8":case"utf-8":return y(this,e,r);case"ascii":return function(t,e,r){var n="";r=Math.min(t.length,r);for(var o=e;o<r;++o)n+=String.fromCharCode(127&t[o]);return n}(this,e,r);case"latin1":case"binary":return function(t,e,r){var n="";r=Math.min(t.length,r);for(var o=e;o<r;++o)n+=String.fromCharCode(t[o]);return n}(this,e,r);case"base64":return o=e,i=r,0===o&&i===this.length?n.fromByteArray(this):n.fromByteArray(this.slice(o,i));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(t,e,r){for(var n=t.slice(e,r),o="",i=0;i<n.length;i+=2)o+=String.fromCharCode(n[i]+256*n[i+1]);return o}(this,e,r);default:if(a)throw TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),a=!0}}function v(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function m(t,e,r,n,o){var i;if(0===t.length)return -1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),(i=r=+r)!=i&&(r=o?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(o)return -1;r=t.length-1}else if(r<0){if(!o)return -1;r=0}if("string"==typeof e&&(e=s.from(e,n)),s.isBuffer(e))return 0===e.length?-1:g(t,e,r,n,o);if("number"==typeof e)return(e&=255,"function"==typeof Uint8Array.prototype.indexOf)?o?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):g(t,[e],r,n,o);throw TypeError("val must be string, number or Buffer")}function g(t,e,r,n,o){var i,a=1,s=t.length,c=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return -1;a=2,s/=2,c/=2,r/=2}function u(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(o){var f=-1;for(i=r;i<s;i++)if(u(t,i)===u(e,-1===f?0:i-f)){if(-1===f&&(f=i),i-f+1===c)return f*a}else -1!==f&&(i-=i-f),f=-1}else for(r+c>s&&(r=s-c),i=r;i>=0;i--){for(var h=!0,p=0;p<c;p++)if(u(t,i+p)!==u(e,p)){h=!1;break}if(h)return i}return -1}function y(t,e,r){r=Math.min(t.length,r);for(var n=[],o=e;o<r;){var i,a,s,c,u=t[o],f=null,h=u>239?4:u>223?3:u>191?2:1;if(o+h<=r)switch(h){case 1:u<128&&(f=u);break;case 2:(192&(i=t[o+1]))==128&&(c=(31&u)<<6|63&i)>127&&(f=c);break;case 3:i=t[o+1],a=t[o+2],(192&i)==128&&(192&a)==128&&(c=(15&u)<<12|(63&i)<<6|63&a)>2047&&(c<55296||c>57343)&&(f=c);break;case 4:i=t[o+1],a=t[o+2],s=t[o+3],(192&i)==128&&(192&a)==128&&(192&s)==128&&(c=(15&u)<<18|(63&i)<<12|(63&a)<<6|63&s)>65535&&c<1114112&&(f=c)}null===f?(f=65533,h=1):f>65535&&(f-=65536,n.push(f>>>10&1023|55296),f=56320|1023&f),n.push(f),o+=h}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);for(var r="",n=0;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=4096));return r}(n)}function b(t,e,r){if(t%1!=0||t<0)throw RangeError("offset is not uint");if(t+e>r)throw RangeError("Trying to access beyond buffer length")}function _(t,e,r,n,o,i){if(!s.isBuffer(t))throw TypeError('"buffer" argument must be a Buffer instance');if(e>o||e<i)throw RangeError('"value" argument is out of bounds');if(r+n>t.length)throw RangeError("Index out of range")}function w(t,e,r,n,o,i){if(r+n>t.length||r<0)throw RangeError("Index out of range")}function x(t,e,r,n,i){return e=+e,r>>>=0,i||w(t,e,r,4,34028234663852886e22,-34028234663852886e22),o.write(t,e,r,n,23,4),r+4}function E(t,e,r,n,i){return e=+e,r>>>=0,i||w(t,e,r,8,17976931348623157e292,-17976931348623157e292),o.write(t,e,r,n,52,8),r+8}e.Buffer=s,e.SlowBuffer=function(t){return+t!=t&&(t=0),s.alloc(+t)},e.INSPECT_MAX_BYTES=50,e.kMaxLength=2147483647,s.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(r){return!1}}(),s.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),s.poolSize=8192,s.from=function(t,e,r){return c(t,e,r)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array),s.alloc=function(t,e,r){return(u(t),t<=0)?a(t):void 0!==e?"string"==typeof r?a(t).fill(e,r):a(t).fill(e):a(t)},s.allocUnsafe=function(t){return f(t)},s.allocUnsafeSlow=function(t){return f(t)},s.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==s.prototype},s.compare=function(t,e){if(C(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),C(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(t)||!s.isBuffer(e))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var r=t.length,n=e.length,o=0,i=Math.min(r,n);o<i;++o)if(t[o]!==e[o]){r=t[o],n=e[o];break}return r<n?-1:n<r?1:0},s.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(t,e){if(!Array.isArray(t))throw TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return s.alloc(0);if(void 0===e)for(r=0,e=0;r<t.length;++r)e+=t[r].length;var r,n=s.allocUnsafe(e),o=0;for(r=0;r<t.length;++r){var i=t[r];if(C(i,Uint8Array)&&(i=s.from(i)),!s.isBuffer(i))throw TypeError('"list" argument must be an Array of Buffers');i.copy(n,o),o+=i.length}return n},s.byteLength=l,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)v(this,e,e+1);return this},s.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)v(this,e,e+3),v(this,e+1,e+2);return this},s.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)v(this,e,e+7),v(this,e+1,e+6),v(this,e+2,e+5),v(this,e+3,e+4);return this},s.prototype.toString=function(){var t=this.length;return 0===t?"":0==arguments.length?y(this,0,t):d.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(t){if(!s.isBuffer(t))throw TypeError("Argument must be a Buffer");return this===t||0===s.compare(this,t)},s.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(t+=" ... "),"<Buffer "+t+">"},i&&(s.prototype[i]=s.prototype.inspect),s.prototype.compare=function(t,e,r,n,o){if(C(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(t))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),e<0||r>t.length||n<0||o>this.length)throw RangeError("out of range index");if(n>=o&&e>=r)return 0;if(n>=o)return -1;if(e>=r)return 1;if(e>>>=0,r>>>=0,n>>>=0,o>>>=0,this===t)return 0;for(var i=o-n,a=r-e,c=Math.min(i,a),u=this.slice(n,o),f=t.slice(e,r),h=0;h<c;++h)if(u[h]!==f[h]){i=u[h],a=f[h];break}return i<a?-1:a<i?1:0},s.prototype.includes=function(t,e,r){return -1!==this.indexOf(t,e,r)},s.prototype.indexOf=function(t,e,r){return m(this,t,e,r,!0)},s.prototype.lastIndexOf=function(t,e,r){return m(this,t,e,r,!1)},s.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else if(isFinite(e))e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var o,i,a,s,c,u,f,h,p,l,d,v,m=this.length-e;if((void 0===r||r>m)&&(r=m),t.length>0&&(r<0||e<0)||e>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var g=!1;;)switch(n){case"hex":return function(t,e,r,n){r=Number(r)||0;var o=t.length-r;n?(n=Number(n))>o&&(n=o):n=o;var i=e.length;n>i/2&&(n=i/2);for(var a=0;a<n;++a){var s=parseInt(e.substr(2*a,2),16);if(s!=s)break;t[r+a]=s}return a}(this,t,e,r);case"utf8":case"utf-8":return c=e,u=r,F(M(t,this.length-c),this,c,u);case"ascii":return f=e,h=r,F(S(t),this,f,h);case"latin1":case"binary":;return o=this,i=t,a=e,s=r,F(S(i),o,a,s);case"base64":return p=e,l=r,F(T(t),this,p,l);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return d=e,v=r,F(function(t,e){for(var r,n,o=[],i=0;i<t.length&&!((e-=2)<0);++i)n=(r=t.charCodeAt(i))>>8,o.push(r%256),o.push(n);return o}(t,this.length-d),this,d,v);default:if(g)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),g=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},s.prototype.slice=function(t,e){var r=this.length;t=~~t,e=void 0===e?r:~~e,t<0?(t+=r)<0&&(t=0):t>r&&(t=r),e<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);var n=this.subarray(t,e);return Object.setPrototypeOf(n,s.prototype),n},s.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);for(var n=this[t],o=1,i=0;++i<e&&(o*=256);)n+=this[t+i]*o;return n},s.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);for(var n=this[t+--e],o=1;e>0&&(o*=256);)n+=this[t+--e]*o;return n},s.prototype.readUInt8=function(t,e){return t>>>=0,e||b(t,1,this.length),this[t]},s.prototype.readUInt16LE=function(t,e){return t>>>=0,e||b(t,2,this.length),this[t]|this[t+1]<<8},s.prototype.readUInt16BE=function(t,e){return t>>>=0,e||b(t,2,this.length),this[t]<<8|this[t+1]},s.prototype.readUInt32LE=function(t,e){return t>>>=0,e||b(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},s.prototype.readUInt32BE=function(t,e){return t>>>=0,e||b(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},s.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);for(var n=this[t],o=1,i=0;++i<e&&(o*=256);)n+=this[t+i]*o;return n>=(o*=128)&&(n-=Math.pow(2,8*e)),n},s.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);for(var n=e,o=1,i=this[t+--n];n>0&&(o*=256);)i+=this[t+--n]*o;return i>=(o*=128)&&(i-=Math.pow(2,8*e)),i},s.prototype.readInt8=function(t,e){return(t>>>=0,e||b(t,1,this.length),128&this[t])?-((255-this[t]+1)*1):this[t]},s.prototype.readInt16LE=function(t,e){t>>>=0,e||b(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},s.prototype.readInt16BE=function(t,e){t>>>=0,e||b(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},s.prototype.readInt32LE=function(t,e){return t>>>=0,e||b(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},s.prototype.readInt32BE=function(t,e){return t>>>=0,e||b(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},s.prototype.readFloatLE=function(t,e){return t>>>=0,e||b(t,4,this.length),o.read(this,t,!0,23,4)},s.prototype.readFloatBE=function(t,e){return t>>>=0,e||b(t,4,this.length),o.read(this,t,!1,23,4)},s.prototype.readDoubleLE=function(t,e){return t>>>=0,e||b(t,8,this.length),o.read(this,t,!0,52,8)},s.prototype.readDoubleBE=function(t,e){return t>>>=0,e||b(t,8,this.length),o.read(this,t,!1,52,8)},s.prototype.writeUIntLE=function(t,e,r,n){if(t=+t,e>>>=0,r>>>=0,!n){var o=Math.pow(2,8*r)-1;_(this,t,e,r,o,0)}var i=1,a=0;for(this[e]=255&t;++a<r&&(i*=256);)this[e+a]=t/i&255;return e+r},s.prototype.writeUIntBE=function(t,e,r,n){if(t=+t,e>>>=0,r>>>=0,!n){var o=Math.pow(2,8*r)-1;_(this,t,e,r,o,0)}var i=r-1,a=1;for(this[e+i]=255&t;--i>=0&&(a*=256);)this[e+i]=t/a&255;return e+r},s.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,1,255,0),this[e]=255&t,e+1},s.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},s.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},s.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},s.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},s.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var o=Math.pow(2,8*r-1);_(this,t,e,r,o-1,-o)}var i=0,a=1,s=0;for(this[e]=255&t;++i<r&&(a*=256);)t<0&&0===s&&0!==this[e+i-1]&&(s=1),this[e+i]=(t/a>>0)-s&255;return e+r},s.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var o=Math.pow(2,8*r-1);_(this,t,e,r,o-1,-o)}var i=r-1,a=1,s=0;for(this[e+i]=255&t;--i>=0&&(a*=256);)t<0&&0===s&&0!==this[e+i+1]&&(s=1),this[e+i]=(t/a>>0)-s&255;return e+r},s.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},s.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},s.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},s.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},s.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||_(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},s.prototype.writeFloatLE=function(t,e,r){return x(this,t,e,!0,r)},s.prototype.writeFloatBE=function(t,e,r){return x(this,t,e,!1,r)},s.prototype.writeDoubleLE=function(t,e,r){return E(this,t,e,!0,r)},s.prototype.writeDoubleBE=function(t,e,r){return E(this,t,e,!1,r)},s.prototype.copy=function(t,e,r,n){if(!s.isBuffer(t))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r||0===t.length||0===this.length)return 0;if(e<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var o=n-r;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(e,r,n);else if(this===t&&r<e&&e<n)for(var i=o-1;i>=0;--i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,n),e);return o},s.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!s.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===t.length){var o,i=t.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(t=i)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw RangeError("Out of range index");if(r<=e)return this;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(o=e;o<r;++o)this[o]=t;else{var a=s.isBuffer(t)?t:s.from(t,n),c=a.length;if(0===c)throw TypeError('The value "'+t+'" is invalid for argument "value"');for(o=0;o<r-e;++o)this[o+e]=a[o%c]}return this};var P=/[^+/0-9A-Za-z-_]/g;function M(t,e){e=e||1/0;for(var r,n=t.length,o=null,i=[],a=0;a<n;++a){if((r=t.charCodeAt(a))>55295&&r<57344){if(!o){if(r>56319||a+1===n){(e-=3)>-1&&i.push(239,191,189);continue}o=r;continue}if(r<56320){(e-=3)>-1&&i.push(239,191,189),o=r;continue}r=(o-55296<<10|r-56320)+65536}else o&&(e-=3)>-1&&i.push(239,191,189);if(o=null,r<128){if((e-=1)<0)break;i.push(r)}else if(r<2048){if((e-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((e-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return i}function S(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}function T(t){return n.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(P,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function F(t,e,r,n){for(var o=0;o<n&&!(o+r>=e.length)&&!(o>=t.length);++o)e[o+r]=t[o];return o}function C(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}var I=function(){for(var t="0123456789abcdef",e=Array(256),r=0;r<16;++r)for(var n=16*r,o=0;o<16;++o)e[n+o]=t[r]+t[o];return e}()},783:function(t,e){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */e.read=function(t,e,r,n,o){var i,a,s=8*o-n-1,c=(1<<s)-1,u=c>>1,f=-7,h=r?o-1:0,p=r?-1:1,l=t[e+h];for(h+=p,i=l&(1<<-f)-1,l>>=-f,f+=s;f>0;i=256*i+t[e+h],h+=p,f-=8);for(a=i&(1<<-f)-1,i>>=-f,f+=n;f>0;a=256*a+t[e+h],h+=p,f-=8);if(0===i)i=1-u;else{if(i===c)return a?NaN:(l?-1:1)*(1/0);a+=Math.pow(2,n),i-=u}return(l?-1:1)*a*Math.pow(2,i-n)},e.write=function(t,e,r,n,o,i){var a,s,c,u=8*i-o-1,f=(1<<u)-1,h=f>>1,p=23===o?5960464477539062e-23:0,l=n?0:i-1,d=n?1:-1,v=e<0||0===e&&1/e<0?1:0;for(isNaN(e=Math.abs(e))||e===1/0?(s=isNaN(e)?1:0,a=f):(a=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-a))<1&&(a--,c*=2),a+h>=1?e+=p/c:e+=p*Math.pow(2,1-h),e*c>=2&&(a++,c/=2),a+h>=f?(s=0,a=f):a+h>=1?(s=(e*c-1)*Math.pow(2,o),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,o),a=0));o>=8;t[r+l]=255&s,l+=d,s/=256,o-=8);for(a=a<<o|s,u+=o;u>0;t[r+l]=255&a,l+=d,a/=256,u-=8);t[r+l-d]|=128*v}}},r={};function n(t){var o=r[t];if(void 0!==o)return o.exports;var i=r[t]={exports:{}},a=!0;try{e[t](i,i.exports,n),a=!1}finally{a&&delete r[t]}return i.exports}n.ab="//";var o=n(72);t.exports=o}()},7663:function(t){!function(){var e={229:function(t){var e,r,n,o=t.exports={};function i(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function s(t){if(e===setTimeout)return setTimeout(t,0);if((e===i||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(n){try{return e.call(null,t,0)}catch(r){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:i}catch(t){e=i}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(n){r=a}}();var c=[],u=!1,f=-1;function h(){u&&n&&(u=!1,n.length?c=n.concat(c):f=-1,c.length&&p())}function p(){if(!u){var t=s(h);u=!0;for(var e=c.length;e;){for(n=c,c=[];++f<e;)n&&n[f].run();f=-1,e=c.length}n=null,u=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(n){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function l(t,e){this.fun=t,this.array=e}function d(){}o.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new l(t,e)),1!==c.length||u||s(p)},l.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=d,o.addListener=d,o.once=d,o.off=d,o.removeListener=d,o.removeAllListeners=d,o.emit=d,o.prependListener=d,o.prependOnceListener=d,o.listeners=function(t){return[]},o.binding=function(t){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},r={};function n(t){var o=r[t];if(void 0!==o)return o.exports;var i=r[t]={exports:{}},a=!0;try{e[t](i,i.exports,n),a=!1}finally{a&&delete r[t]}return i.exports}n.ab="//";var o=n(229);t.exports=o}()},9008:function(t,e,r){t.exports=r(3121)},4970:function(t,e,r){var n;t.exports=(n=r(7294),function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e||4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,(function(e){return t[e]}).bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(t,e,r){"use strict";r.r(e);var n,o=r(/*! react */"react"),i=(n=function(t,e){return(n=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),a=function(){return(a=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},s=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&0>e.indexOf(n)&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)0>e.indexOf(n[o])&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r};function c(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}"undefined"!=typeof window&&(void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(t){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return e?new Promise(function(r,n){e.call(navigator,t,r,n)}):Promise.reject(Error("getUserMedia is not implemented in this browser"))}));var u=function(t){function e(e){var r=t.call(this,e)||this;return r.canvas=null,r.ctx=null,r.requestUserMediaId=0,r.unmounted=!1,r.state={hasUserMedia:!1},r}return i(e,t),e.prototype.componentDidMount=function(){var t=this.state,e=this.props;if(this.unmounted=!1,!c()){e.onUserMediaError("getUserMedia not supported");return}t.hasUserMedia||this.requestUserMedia(),e.children&&"function"!=typeof e.children&&console.warn("children must be a function")},e.prototype.componentDidUpdate=function(t){var e=this.props;if(!c()){e.onUserMediaError("getUserMedia not supported");return}var r=JSON.stringify(t.audioConstraints)!==JSON.stringify(e.audioConstraints),n=JSON.stringify(t.videoConstraints)!==JSON.stringify(e.videoConstraints),o=t.minScreenshotWidth!==e.minScreenshotWidth,i=t.minScreenshotHeight!==e.minScreenshotHeight;(n||o||i)&&(this.canvas=null,this.ctx=null),(r||n)&&(this.stopAndCleanup(),this.requestUserMedia())},e.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},e.stopMediaStream=function(t){t&&(t.getVideoTracks&&t.getAudioTracks?(t.getVideoTracks().map(function(e){t.removeTrack(e),e.stop()}),t.getAudioTracks().map(function(e){t.removeTrack(e),e.stop()})):t.stop())},e.prototype.stopAndCleanup=function(){var t=this.state;t.hasUserMedia&&(e.stopMediaStream(this.stream),t.src&&window.URL.revokeObjectURL(t.src))},e.prototype.getScreenshot=function(t){var e=this.state,r=this.props;if(!e.hasUserMedia)return null;var n=this.getCanvas(t);return n&&n.toDataURL(r.screenshotFormat,r.screenshotQuality)},e.prototype.getCanvas=function(t){var e=this.state,r=this.props;if(!this.video||!e.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var n=this.video.videoWidth,o=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var i=n/o;o=(n=r.minScreenshotWidth||this.video.clientWidth)/i,r.minScreenshotHeight&&o<r.minScreenshotHeight&&(n=(o=r.minScreenshotHeight)*i)}this.canvas=document.createElement("canvas"),this.canvas.width=(null==t?void 0:t.width)||n,this.canvas.height=(null==t?void 0:t.height)||o,this.ctx=this.canvas.getContext("2d")}var a=this.ctx,s=this.canvas;return a&&s&&(r.mirrored&&(a.translate(s.width,0),a.scale(-1,1)),a.imageSmoothingEnabled=r.imageSmoothing,a.drawImage(this.video,0,0,(null==t?void 0:t.width)||s.width,(null==t?void 0:t.height)||s.height),r.mirrored&&(a.scale(-1,1),a.translate(-s.width,0))),s},e.prototype.requestUserMedia=function(){var t=this,r=this.props,n=function(n,o){var i={video:void 0===o||o};r.audio&&(i.audio=void 0===n||n),t.requestUserMediaId++;var a=t.requestUserMediaId;navigator.mediaDevices.getUserMedia(i).then(function(r){t.unmounted||a!==t.requestUserMediaId?e.stopMediaStream(r):t.handleUserMedia(null,r)}).catch(function(e){t.handleUserMedia(e)})};if("mediaDevices"in navigator)n(r.audioConstraints,r.videoConstraints);else{var o=function(t){return{optional:[{sourceId:t}]}},i=function(t){var e=t.deviceId;return"string"==typeof e?e:Array.isArray(e)&&e.length>0?e[0]:"object"==typeof e&&e.ideal?e.ideal:null};MediaStreamTrack.getSources(function(t){var e=null,a=null;t.forEach(function(t){"audio"===t.kind?e=t.id:"video"===t.kind&&(a=t.id)});var s=i(r.audioConstraints);s&&(e=s);var c=i(r.videoConstraints);c&&(a=c),n(o(e),o(a))})}},e.prototype.handleUserMedia=function(t,e){var r=this.props;if(t||!e){this.setState({hasUserMedia:!1}),r.onUserMediaError(t);return}this.stream=e;try{this.video&&(this.video.srcObject=e),this.setState({hasUserMedia:!0})}catch(n){this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(e)})}r.onUserMedia(e)},e.prototype.render=function(){var t=this,e=this.state,r=this.props,n=r.audio,i=(r.forceScreenshotSourceSize,r.onUserMedia,r.onUserMediaError,r.screenshotFormat,r.screenshotQuality,r.minScreenshotWidth,r.minScreenshotHeight,r.audioConstraints,r.videoConstraints,r.imageSmoothing,r.mirrored),c=r.style,u=void 0===c?{}:c,f=r.children,h=s(r,["audio","forceScreenshotSourceSize","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),p=i?a(a({},u),{transform:(u.transform||"")+" scaleX(-1)"}):u,l={getScreenshot:this.getScreenshot.bind(this)};return o.createElement(o.Fragment,null,o.createElement("video",a({autoPlay:!0,src:e.src,muted:!n,playsInline:!0,ref:function(e){t.video=e},style:p},h)),f&&f(l))},e.defaultProps={audio:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},e}(o.Component);e.default=u},react:function(t,e){t.exports=n}}).default)}}]);